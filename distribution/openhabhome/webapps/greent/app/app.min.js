(function(_1){if(typeof define==="function"&&define.amd){_1(jQuery,Ext,OpenHAB);}else{_1(jQuery,Ext,OpenHAB);}}(function(_2,_3,_4){var _5="1.0.1";var _6="1003";var _7="not known";var _8=false;var _9;var _a;var _b;var _c=null;var _d=$.atmosphere;var _e=null;var _f;var _10;function _11(_12){var _13={url:_12,maxRequest:256,timeout:59000,attachHeadersAsQueryString:true,executeCallbackBeforeReconnect:false,transport:_14,fallbackTransport:_e,enableProtocol:false,headers:{"Accept":"application/json"},onError:function(_15){},onOpen:function(_16){_c=_16.transport;},onMessage:function(_17){if(_17.status==200){var _18=_17.responseBody;if(_18.length>0){try{_19(_3.JSON.decode(_18));}catch(e){}}}}};_d.subscribe(_13);};function _1a(){_d.unsubscribe();};function _1b(){_3.Ajax.request({url:"/static/version",success:function(_1c){_7=_1c.responseText;_1d();}});};function _1d(){};function _1e(_1f){_3.data.JsonP.request({url:_1f+"/check.php?version="+_6,callbackKey:"callback",success:function(_20,_21){if(_20.status==true){_8=_20.needsUpdate;_9=_20.lastBuildName;_a=_20.lastBuildNumber;_b=_20.info;if(_4.enableUpdates=="true"){if(_20.needsUpdate==true){var _22=confirm("GreenT UI version "+_20.lastBuildName+" is available. Do you want to update now?");if(_22){if(!_23){_24();_23.setActiveItem(2);}else{_23.setActiveItem(2);}}}}}else{alert("Error reading update server!");}}});};function _19(_25){if(_3.isArray(_25.widget)){_3.each(_25.widget,function(_26,_27){if(_26.type=="Frame"){if(_3.isArray(_26.widget)){_3.each(_26.widget,function(_28,_29){_2a(_28);});}else{_2a(_26.widget);}}else{_2a(_26);}});}else{_2a(_25.widget);}if(_2b!="Phone"){if(_25.parent&&_25.parent.id==_2c){_2d(_25.title);_2e(_25.id,_25.title,_25.icon);}else{if(_25.id==_2c){_2f();}else{_2f();}}}else{_2d(_25.title);}};var _30={};var _31={expanded:true,text:"Left nav",children:[]};var _32=[];var _33=[];var _34="";var _35;var _23=null;var _36="";var _2b;var _37=false;var _38;var _2c;var _39;var _3a={type:"slide",direction:"left"};var _3b;var _3c="oph_icon";var _3d="background-image:url";var _3e;var _3f=false;function _40(_41,_42){var _43=localStorage.getItem(_41);if(!_43||_43=="null"){return _42;}else{return _43;}};function _44(){var _45=_40("openHAB_theme","GreenT");if(_4.themes.indexOf(_45)==-1){_45="GreenT";}var _46="./themes/"+_45+"/css/style.css";var _47=document.createElement("link");_47.setAttribute("rel","stylesheet");_47.setAttribute("type","text/css");_47.setAttribute("href",_46);document.getElementsByTagName("head")[0].appendChild(_47);};var _48=_40("openHAB_language","en");var _49=_40("openHAB_transitions","1");var _14=_40("openHAB_transport","auto");var _4a=_4.i18n_strings[_48];var _4b=3;var _4c=new _3.data.Store({fields:["name","value"],autoLoad:true});var _4d;_4d=new _3.data.Store({fields:["name","value"],autoLoad:true,listeners:{exception:function(_4e,_4f,op,opt){if(_4b>0){_4d.load();_4b--;}else{_4b=3;alert(_4a.error_server_connection);}},load:function(_50,_51,_52){if(_52){_3.iterate(_51,function(_53){_53.data.value=_53.data.name;});_4b=3;_4c.insert(0,[{name:"- "+_4a.choose_on_startup,value:"choose"}]);_4d.each(function(_54){_4c.add(_54.copy());});}else{if(_4b>0){_4d.load();_4b--;}else{_4b=3;alert(_4a.error_server_connection);}}}},proxy:{type:"ajax",url:"/rest/sitemaps",headers:{"Accept":"application/json"},noCache:true,limitParam:undefined,startParam:undefined,pageParam:undefined,reader:{type:"json",rootProperty:"sitemap"}}});var _55={id:"sitemapsWindow",floating:true,centered:true,height:300,layout:"fit",scrollable:false,items:[{title:_4a.interfaces,xtype:"toolbar",ui:"light",docked:"top"},{xtype:"list",store:_4d,singleSelect:true,itemTpl:"{name}",scrollable:false,height:300,listeners:{itemtap:function(_56,_57,_58,_59){_38=_59.data.name;_5a(_38);_3b.destroy();}}}]};function _5b(){return _33[_33.length-1][0];};var _4;var _5c={id:"settingsWindow",floating:true,centered:true,layout:"card",items:[{scrollable:"vertical",items:[{xtype:"toolbar",ui:"light",docked:"top",items:[{xtype:"spacer"},{xtype:"label",cls:"x-title",centered:true,zIndex:0,html:_4a.settings},{xtype:"spacer"},{iconCls:"delete",iconMask:true,ui:"normal",handler:function(){if(_3f){localStorage.setItem("openHAB_sitemap",_23.getItems().items[0].getItems().items[1].getValue());localStorage.setItem("openHAB_device_type",_23.getItems().items[0].getItems().items[2].getValue());localStorage.setItem("openHAB_language",_23.getItems().items[0].getItems().items[3].getValue());localStorage.setItem("openHAB_theme",_23.getItems().items[0].getItems().items[4].getValue());localStorage.setItem("openHAB_transport",_23.getItems().items[0].getItems().items[5].getValue());localStorage.setItem("openHAB_transitions",_23.getItems().items[0].getItems().items[6].getValue());alert(_4a.need_to_restart_for_changes_to_take_effect);window.location.reload();}_23.destroy();_23=null;}}]},{xtype:"selectfield",label:_4a.default_sitemap,labelWidth:"40%",store:_4c,displayField:"name",valueField:"value",style:"border-bottom: 1px solid E6E6E6;",listeners:{change:function(){_3f=true;}}},{xtype:"selectfield",label:_4a.this_device_is,labelWidth:"40%",style:"border-bottom: 1px solid E6E6E6;",listeners:{change:function(){_3f=true;}},options:[{text:_4a.auto_detect,value:"Auto"},{text:_4a.phone,value:"Phone"},{text:_4a.tablet,value:"Tablet"},{text:_4a.pc,value:"Desktop"}]},{xtype:"selectfield",label:_4a.interface_language,labelWidth:"40%",style:"border-bottom: 1px solid E6E6E6;",listeners:{change:function(){_3f=true;}}},{xtype:"selectfield",label:_4a.theme,labelWidth:"40%",style:"border-bottom: 1px solid E6E6E6;",listeners:{change:function(){_3f=true;}}},{xtype:"selectfield",label:_4a.transport_protocol,labelWidth:"40%",style:"border-bottom: 1px solid E6E6E6;",listeners:{change:function(){_3f=true;}}},{xtype:"togglefield",label:_4a.transitions,labelWidth:"40%",style:"border-bottom: 1px solid E6E6E6;",listeners:{change:function(){_3f=true;}}},{xtype:"button",text:"<img style=\"height:100%;\" src=\"./app/logo_tr.png\" border=\"0\" />",style:"clear:both;margin:0.7em 5%;height:3.6em;",scope:this,cls:"oph_about_btn",handler:function(){_23.setActiveItem(1);}}]},{cls:"oph_about_page",scrollable:"vertical",items:[{xtype:"toolbar",ui:"light",docked:"top",items:[{ui:"back",text:_4a.back,handler:function(){_23.setActiveItem(0);}},{xtype:"spacer"},{xtype:"label",cls:"x-title",centered:true,zIndex:0,html:"GreenT UI"},{xtype:"spacer"},{iconCls:"delete",iconMask:true,ui:"normal",handler:function(){_23.destroy();_23=null;}}]},{xtype:"container",cls:"oph_about_page_content"}]},{cls:"oph_update_page",scrollable:"vertical",items:[{xtype:"toolbar",ui:"light",docked:"top",items:[{ui:"back",text:_4a.back,handler:function(){_23.setActiveItem(1);}},{xtype:"spacer"},{xtype:"label",cls:"x-title",centered:true,zIndex:0,html:"GreenT UI Update"},{xtype:"spacer"},{iconCls:"delete",iconMask:true,ui:"normal",handler:function(){_23.destroy();_23=null;}}]},{xtype:"container",cls:"oph_about_page_content"},{xtype:"button",text:"Update GreenT UI",scope:this,style:"margin:0.8em 5%;height:3em;",ui:"confirm",handler:function(btn){_23.getItems().items[2].getItems().items[2].destroy();_5d("update_greent","ON");_23.getItems().items[2].getItems().items[1].setHtml("");_3.defer(_5e,3000,this);}}]}]};function _5e(){_3.Ajax.request({url:"/greent/update.tmp",success:function(_5f){_23.getItems().items[2].getItems().items[1].setHtml(_5f.responseText);_3.defer(_5e,3000,this);},failure:function(_60){_3.defer(_5e,3000,this);}});};function _5a(_61){_3.getCmp("content").setMasked({xtype:"loadmask",message:_4a.loading});_3.Ajax.request({url:"/rest/sitemaps/"+_61,headers:{"Accept":"application/json"},success:function(_62){var _63;try{_63=_3.JSON.decode(_62.responseText);}catch(error){_5a(_61);return;}_68(_63.homepage,_31);_74();_3.getCmp("content").unmask();_33[0]=[_63.homepage.id,_63.homepage.title];_3.getCmp("title").setHtml(_63.homepage.title);if(_3.getCmp("leftPanel")){_64.setData(_31);_99(_63.homepage.id);}_9a(_63.homepage.id);},failure:function(){alert(_4a.error_server_connection);}});};_3.define("LeftPanelListItem",{extend:"Ext.data.Model",config:{fields:[{name:"icon",type:"string"},{name:"text",type:"string"},{name:"page_id",type:"string"},{name:"page_label",type:"string"},{name:"name",type:"string"}]}});var _64=new _3.data.TreeStore({model:"LeftPanelListItem",autoLoad:false,proxy:{type:"memory",reader:{type:"json",rootProperty:"children"}}});function _65(_66,_67){if(_66){_67.push(_66);}};function _68(_69,_6a){try{if(_69){var _6b;_30[_69.id]=[];_6b=_30[_69.id];var _6c=_69.widget;if(_3.isArray(_6c)){var _6d=false;_3.each(_6c,function(_6e,_6f){if(_6e.type!="Frame"){if(!_6d){_6b.push({xtype:"fieldset",title:"",cls:["oph_fieldset",_36+"_fieldset","oph_clearfix"]});_6b=_6b[_6b.length-1]["items"]=[];_6d=true;}_65(_73(_6e.widgetId,_6e,_6b,_6a),_6b);}else{if(_6e.type=="Frame"){_6d=false;_6b.push({xtype:"fieldset",title:_6e.label,cls:["oph_fieldset",_36+"_fieldset","oph_clearfix"]});_6b[_6b.length-1]["items"]=[];if(_3.isArray(_6e.widget)){_3.each(_6e.widget,function(_70,k){_65(_73(_70.widgetId,_70,_6b[_6b.length-1]["items"],_6a),_6b[_6b.length-1]["items"]);});}else{_65(_73(_6e.widget.widgetId,_6e.widget,_6b[_6b.length-1]["items"],_6a),_6b[_6b.length-1]["items"]);}}}});}else{if(_6c.type!="Frame"){_6b.push({xtype:"fieldset",title:"",cls:["oph_fieldset",_36+"_fieldset","oph_clearfix"]});_6b=_6b[_6b.length-1]["items"]=[];_65(_73(_6c.widgetId,_6c,_6b,_6a),_6b);}else{if(_6c.type=="Frame"){_6b.push({xtype:"fieldset",title:_6c.label,cls:["oph_fieldset",_36+"_fieldset","oph_clearfix"]});_6b[_6b.length-1]["items"]=[];if(_3.isArray(_6c.widget)){_3.each(_6c.widget,function(_71,_72){_65(_73(_71.widgetId,_71,_6b[_6b.length-1]["items"],_6a),_6b[_6b.length-1]["items"]);});}else{_65(_73(_6c.widget.widgetId,_6c.widget,_6b[_6b.length-1]["items"],_6a),_6b[_6b.length-1]["items"]);}}}}}}catch(e){alert(_4a.error_build_interface);}};function _74(){_3.iterate(_30,function(key,_75){var _76=[];_3.each(_75,function(obj){if(obj.items&&obj.items.length>0){_76.push(obj);}});_30[key]=_76;});};function _73(id,_77,_78,_79){var _7a;var _7b;if(_77.type=="Switch"){if(_77.item&&_77.item.type=="RollershutterItem"){_7a=_7c(_77.item?_77.item.name:"",_77.label,_77.icon);}else{if(_77.item&&_77.item.type=="NumberItem"){_7a=_7d(_77.item?_77.item.name:"",_77.mapping,_77.label,_77.icon);}else{if(_77.item&&_77.item.type=="SwitchItem"&&_77.mapping){_7a=_7d(_77.item?_77.item.name:"",_77.mapping,_77.label,_77.icon);}else{if(_77.item&&_77.item.type=="GroupItem"&&_77.mapping){_7a=_7d(_77.item?_77.item.name:"",_77.mapping,_77.label,_77.icon);}else{_7a=_7e(_77.item?_77.item.name:"",_77.label,_77.icon);}}}}}else{if(_77.type=="Slider"){_7a=_7f(_77.item?_77.item.name:"",_77.label,_77.icon);}else{if(_77.type=="Setpoint"){_7a=_80(_77.item?_77.item.name:"",_77.minValue,_77.maxValue,_77.step,_77.label,_77.icon);}else{if(_77.type=="Video"){_7a=_81(_77.item?_77.item.name:"",_77.url,_77.label,_77.icon);}else{if(_77.type=="Webview"){_7a=_82(_77.item?_77.item.name:"",_77.url,_77.height,_77.label,_77.icon);}else{if(_77.type=="Chart"){_7a=_83(_77.item?_77.item.name:"",id,_77.w,_77.h,_77.period,_77.refresh,_77.item?_77.item.type:"",_77.label,_77.icon);}else{if(_77.type=="Text"){if(_77.linkedPage){if(_2b=="Phone"){_7a=_84(_77);}else{_7b=_85(id,_77,_79);}_68(_77.linkedPage,_7b);}else{_7a=_86(_77.label,_77.icon);}}else{if(_77.type=="Group"){if(_2b=="Phone"){_7a=_84(_77);}else{_7b=_85(id,_77,_79);}_68(_77.linkedPage,_7b);}else{if(_77.type=="Selection"){_7a=_87(_77.item?_77.item.name:"",_77.mapping,_77.label,_77.icon);}else{if(_77.type=="Image"){if(_77.linkedPage){if(_2b=="Phone"){_7a=_88(_77.url,_77.linkedPage.id,_77.linkedPage.title);}else{_7b=_85(id,_77,_79);_7a=_88(_77.url,_77.linkedPage.id,_77.linkedPage.title);}_68(_77.linkedPage,_7b);}else{_7a=_89(_77.url);}}else{if(_77.type=="Frame"){}else{_7a=_8a();}}}}}}}}}}}if(_7a){_7a.name=id;}return _7a;};function _85(id,_8b,_8c){var _8d;if(_8b.linkedPage){_8d=_8b.linkedPage.id;}else{_8d="none";}_65({icon:_8b.icon,text:_8b.label.replace(/[\[\]']+/g,""),page_id:_8d,page_label:_8b.label,leaf:true,name:id,id:id},_8c.children);_8c.leaf=false;_8c.children[_8c.children.length-1].children=[];return _8c.children[_8c.children.length-1];};function _24(){if(_23){_23.destroy();_23=null;}else{_23=new _3.Panel(_5c);_23.setCls(_36+"_modal");_23.getItems().items[0].getItems().items[1].setValue(_40("openHAB_sitemap","choose"));_23.getItems().items[0].getItems().items[2].setValue(_40("openHAB_device_type","auto"));var _8e=[];_3.iterate(_4.i18n_strings,function(key,_8f){_8e.push({text:_8f.language_name,value:key});});_23.getItems().items[0].getItems().items[3].setOptions(_8e);_23.getItems().items[0].getItems().items[3].setValue(_40("openHAB_language","en"));_8e=[];_3.iterate(_4.themes,function(key,_90){_8e.push({text:_90,value:_90});});_23.getItems().items[0].getItems().items[4].setOptions(_8e);_23.getItems().items[0].getItems().items[4].setValue(_40("openHAB_theme","GreenT"));_23.getItems().items[0].getItems().items[5].setOptions([{text:_4a.auto_detect,value:"auto"},{text:"Websockets",value:"websocket"},{text:"HTTP Streaming",value:"streaming"},{text:"HTTP Long-polling",value:"long-polling"}]);_23.getItems().items[0].getItems().items[5].setValue(_40("openHAB_transport","auto"));_23.getItems().items[0].getItems().items[6].setValue(_49);var _91=50;if(_2b=="Phone"){_91=85;}var _92="";if(_4.enableUpdates=="true"||_4.enableUpdates=="password"){if(_8){_92=" <i>(<a href=\"#\" style=\"color:red\" id=\"update_button\">UPDATE</a>)</i>";}else{_92=" <i>(up to date)</i>";}}_23.getItems().items[1].getItems().items[1].setHtml("<div style=\"text-align:center;font-size:1em;\"><img style=\"width:"+_91+"%;margin:1em;\" src=\"./app/logo.png\" border=\"0\"/><br><b>GreenT UI installed version:</b> "+_5+"<br><b>GreenT UI available version:</b> "+_9+_92+"<br><b>openHAB version:</b> "+_7+"<br><br><b>Transport Protocol:</b> "+_c+"<br><a style=\"color:#87a600;\" target=\"_blank\" href=\"http://m-design.bg/greent/\">GreenT UI Website</a></div>");_23.getItems().items[2].getItems().items[1].setHtml("<div style=\"padding-top:0.5em;text-align:center;font-size:1em;\"><b>Installed version:</b> "+_5+" <i>(build "+_6+")</i><br><b>Version to update: </b>"+_9+" <i>(build "+_a+")</i><br><br><b>Update info:</b><br>"+_b+"</div><br><br>");_3.Viewport.add(_23);try{_3.get("update_button").clearListeners();_3.get("update_button").on("tap",function(){if(_4.enableUpdates=="password"){var _93=prompt("Enter a password:","");if(_93==_4.updatesPassword){_23.setActiveItem(2);}else{alert("Wrong password!");}}else{if(_4.enableUpdates=="true"){_23.setActiveItem(2);}}});}catch(e){}_3f=false;}};function _94(_95,_96,_97,e,_98){if(_98.raw.page_id=="none"){return;}_39.getBackButton().show();if(_98.raw.leaf){if(_37){_33.pop();}_37=true;}else{if(_37){_33.pop();}_37=false;_99(_98.raw.page_id);}_33.push([_98.raw.page_id,_98.raw.page_label]);if(_30[_98.raw.page_id].length>0){_9a(_98.raw.page_id);}};function _9b(btn,evt){if(btn.config.page_id=="none"){return;}btn.addCls("selected");if(_2b=="Phone"){_33.push([btn.config.page_id,btn.config.page_label]);_3a={type:"slide",direction:"left"};_9a(btn.config.page_id);}else{var _9c=_3.getCmp("leftPanel").getActiveItem();var _9d=_9c.getStore().getAt(_9c.getStore().find("page_id",btn.config.page_id)).data.index;_9c.select(_9d,false,false);_94(_9c,"",_9d,"",_9c.getStore().getAt(_9c.getStore().find("page_id",btn.config.page_id)));}};function _9e(){if(_33.length>1){_33.pop();_3a={type:"slide",direction:"right"};_9a(_33[_33.length-1][0]);}};function _9a(_9f){_35=new Oph.form.Panel({scrollable:"vertical",autoDestroy:true,cls:["oph_widgets_container",_36+"_widgets_container"]});_35.add(_30[_9f]);if(_49=="0"){_3.getCmp("content").setActiveItem(_35);}else{if(_49=="1"){_3.getCmp("content").animateActiveItem(_35,_3a);}}};function _a0(_a1,_a2){if(_a1==_5b()){var _a3="";var _a4=5000;if(!_a2||_a2=="normal"){_a3={"Accept":"application/json"};}else{if(_a2=="long-poll"){_1a();_11("/rest/sitemaps/"+_38+"/"+_a1);return;}}_3.each(_32,function(_a5){_3.Ajax.abort(_a5);_32.pop();});var req=_3.Ajax.request({url:"/rest/sitemaps/"+_38+"/"+_a1,headers:_a3,disableCaching:true,timeout:_a4,failure:function(_a6){if(_a2=="long-poll"){_a0(_a1,"long-poll");}else{_a0(_a1,"normal");}},success:function(_a7){if(_a7.statusText=="OK"&&_a7.responseText!=""){try{var _a8=_3.JSON.decode(_a7.responseText);}catch(exception){_a0(_a1,"normal");return;}_19(_a8);_a0(_a1,"long-poll");}else{}}});_32.push(req);}};function _2a(_a9){if(_f[_a9.widgetId]){_f[_a9.widgetId].setValueData(_a9);}else{if(_2b!="Phone"){_aa(_a9);}}};function _2e(_ab,_ac,_ad){var _ae=_3.getCmp("leftPanel").getActiveItem().getStore();var _af=_ae.find("page_id",_ab);if(_af!=-1){_ae.getAt(_af).set("text",_ac.replace(/[\[\]']+/g,""));_ae.getAt(_af).set("icon",_ad);}};function _aa(_b0){var _b1=_3.getCmp("leftPanel").getActiveItem().getStore();var _b2=_b1.find("name",_b0.widgetId);if(_b2!=-1){_b1.getAt(_b2).set("text",_b0.label.replace(/[\[\]']+/g,""));_b1.getAt(_b2).set("icon",_b0.icon);}};function _b3(){if(_14=="auto"){_14="websocket";_e="streaming";if(_3.os.is.Android2){_e="long-polling";}}else{_e=_14;}_3e="auto";_2b=localStorage.getItem("openHAB_device_type");if(_2b&&_2b!="Auto"){}else{_2b=_3.os.deviceType;}if(_2b=="Phone"){_36="oph_phone";_3e=true;}else{if(_2b=="Tablet"){_36="oph_tablet";_3e=false;}else{_36="oph_desktop";_3e=false;}}};_3.define("Oph.field.ButtonsSelect",{extend:"Ext.field.Field",xtype:"oph_buttons_selectfield",config:{cls:"x-buttons-field",styleHtmlContent:true,styleHtmlCls:"oph_none",labelWidth:"50%"},constructor:function(_b4){_b4=_b4||{};this.callParent([_b4]);},applyComponent:function(_b5){var _b6=this;var _b7=_3.factory({styleHtmlContent:true,styleHtmlCls:"oph_right"},_3.Container);if(_3.isArray(this.config.options)){_3.each(this.config.options,function(_b8,_b9){var _ba=_b7.add(_3.create("Ext.Button",{cls:"x-button-normal oph_selection_btn",item:_b6.config.oph_item,command:_b8.command,text:_b8.label}));_ba.on({tap:function(){_5d(this.config.item,this.config.command);}});});}else{var _bb=_b7.add(_3.create("Ext.Button",{cls:"x-button-normal oph_selection_btn",item:_b6.config.oph_item,command:_b6.config.options.command,text:this.config.options.label}));_bb.on({tap:function(){_5d(this.config.item,this.config.command);}});}return _b7;},initialize:function(){this.callParent();},setValueData:function(_bc){var _bd=this;this.setLabel("<div class=\""+_3c+"\" style=\""+_3d+"(/images/"+_bc.icon+".png);\"></div><div class=\"oph_label\">"+_bc.label.replace(/[\[\]']+/g,"")+"</div>");if(_3.isArray(_bc.mapping)){_3.each(_bc.mapping,function(_be,_bf){_bd._component._items.items[_bf].removeCls("x-button-action");if(_bc.item.state==_bc.mapping[_bf].command){_bd._component._items.items[_bf].addCls("x-button-action");}});}else{this._component._items.items[0].addCls("x-button-action");}}});_3.define("Oph.field.Slider",{extend:"Ext.field.Slider",xtype:"oph_sliderfield",config:{labelWidth:"50%"},constructor:function(_c0){_c0=_c0||{};this.callParent([_c0]);},initialize:function(){var _c1=this;this.callParent();this.on({painted:function(_c2){_c1._component.element.on({tap:function(){_5d(_c1.config.oph_item,_c1.getValue());}});this._component.getThumb(0).element.on({dragend:function(){_5d(_c1.config.oph_item,_c1.getValue());}});}});},setValueData:function(_c3){if(_c3.item){this.setValue(_c3.item.state);}this.setLabel("<div class=\""+_3c+"\" style=\""+_3d+"(/images/"+_c3.icon+".png);\"></div><div class=\"oph_label\">"+_c3.label.replace(/[\[\]']+/g,"")+"</div>");return this;}});_3.define("Oph.field.Setpoint",{extend:"Ext.field.Spinner",xtype:"oph_setpointfield",config:{labelWidth:"50%"},constructor:function(_c4){_c4=_c4||{};this.callParent([_c4]);},initialize:function(){var _c5=this;this.callParent();this.on({spindown:function(_c6,_c7){_5d(_c5.config.oph_item,_c7);},spinup:function(_c8,_c9){_5d(_c5.config.oph_item,_c9);}});},setValueData:function(_ca){if(_ca.item){if(_ca.item.state=="Uninitialized"){this.setValue(Number(this.config.minValue));}else{this.setValue(Number(_ca.item.state));}}this.setLabel("<div class=\""+_3c+"\" style=\""+_3d+"(/images/"+_ca.icon+".png);\"></div><div class=\"oph_label\">"+_ca.label.replace(/[\[\]']+/g,"")+"</div>");return this;}});_3.define("Oph.field.Select",{extend:"Ext.field.Select",xtype:"oph_selectfield",config:{displayField:"label",valueField:"command",labelWidth:"50%"},constructor:function(_cb){_cb=_cb||{};this.callParent([_cb]);},initialize:function(){var _cc=this;this.callParent();this.on({painted:function(_cd){_cc.on({selected:function(){_5d(_cc.config.oph_item,_cc.getValue());}});}});},setValueData:function(_ce){if(_ce.item){this.setValue(_ce.item.state);}this.setLabel("<div class=\""+_3c+"\" style=\""+_3d+"(/images/"+_ce.icon+".png);\"></div><div class=\"oph_label\">"+_ce.label.replace(/[\[\]']+/g,"")+"</div>");return this;},onListSelect:function(_cf,_d0){var me=this;if(_d0){me.setValue(_d0);this.fireEvent("selected",this);}},onPickerChange:function(_d1,_d2){var me=this,_d3=me.getValue(),_d4=_d2[me.getName()],_d5=me.getStore(),_d6=_d5.find(me.getValueField(),_d4);var _d7=_d5.getAt(_d6);me.setValue(_d7);this.fireEvent("selected",this);}});_3.define("Oph.field.Text",{extend:"Ext.field.Field",xtype:"oph_textfield",config:{cls:"x-textfield",styleHtmlContent:true,styleHtmlCls:"oph_none",labelWidth:"50%"},constructor:function(_d8){_d8=_d8||{};this.callParent([_d8]);},initialize:function(){this.callParent();},setValueData:function(_d9){this.setHtml(_d9.label.match(/\[(.*?)\]/)?_d9.label.match(/\[(.*?)\]/)[1]:_d9.label);this.setLabel("<div class=\""+_3c+"\" style=\""+_3d+"(/images/"+_d9.icon+".png);\"></div><div class=\"oph_label\">"+_d9.label.replace(/\[(.*?)\]/,"")+"</div>");return this;}});_3.define("Oph.field.Toggle",{extend:"Ext.field.Toggle",xtype:"oph_togglefield",config:{labelWidth:"50%"},constructor:function(_da){_da=_da||{};this.callParent([_da]);},initialize:function(){var _db=this;this.callParent();this.on({painted:function(_dc){_db._component.element.on({singletap:function(){_5d(_db.config.oph_item,_db.formatOutputValue(_db.getValue()));}});_db._component.getThumb(0).element.on({dragend:function(){_5d(_db.config.oph_item,_db.formatOutputValue(_db.getValue()));}});}});},setValueData:function(_dd){if(_dd.item){this.setValue(this.formatInputValue(_dd.item.state));}this.setLabel("<div class=\""+_3c+"\" style=\""+_3d+"(/images/"+_dd.icon+".png);\"></div><div class=\"oph_label\">"+_dd.label.replace(/[\[\]']+/g,"")+"</div>");return this;},formatInputValue:function(_de){if(_de=="ON"){return 1;}else{return 0;}},formatOutputValue:function(_df){if(_df==1){return "ON";}else{if(_df==0){return "OFF";}}}});function _5d(_e0,_e1){if(_e0){_3.Ajax.request({comm_method:"ajax",url:"/rest/items/"+_e0+"/",method:"POST",params:_e1,headers:{"Content-Type":"text/plain"},failure:function(){}});}};_3.define("Oph.field.Rollershutter",{extend:"Ext.field.Field",xtype:"oph_rollershutterfield",config:{cls:"x-rollershutter-field",styleHtmlContent:true,styleHtmlCls:"oph_none",labelWidth:"50%"},constructor:function(_e2){_e2=_e2||{};this.callParent([_e2]);},applyComponent:function(_e3){var _e4=this;var _e5=_3.factory({styleHtmlContent:true,styleHtmlCls:"oph_right"},_3.Container);var _e6=_e5.add(_3.create("Ext.Button",{cls:"x-button-normal oph_rollershutter_btn",longPress:false,iconCls:"arrow_up",iconMask:true}));_e6.element.item=_e4.config.oph_item;_e6.element.on({touchstart:function(){_5d(this.item,"UP");},longpress:function(){_e6.longPress=true;},tap:function(){if(_e6.longPress){_e6.longPress=false;_5d(this.item,"STOP");}}});var _e7=_e5.add(_3.create("Ext.Button",{cls:"x-button-normal oph_rollershutter_btn",iconCls:"delete",iconMask:true}));_e7.element.item=_e4.config.oph_item;_e7.element.on({tap:function(){_5d(this.item,"STOP");}});var _e8=_e5.add(_3.create("Ext.Button",{cls:"x-button-normal oph_rollershutter_btn",longPress:false,iconCls:"arrow_down",iconMask:true}));_e8.element.item=_e4.config.oph_item;_e8.element.on({touchstart:function(){_5d(this.item,"DOWN");},longpress:function(){_e8.longPress=true;},tap:function(){if(_e8.longPress){_e8.longPress=false;_5d(this.item,"STOP");}}});return _e5;},initialize:function(){this.callParent();},setValueData:function(_e9){this.setLabel("<div class=\""+_3c+"\" style=\""+_3d+"(/images/"+_e9.icon+".png);\"></div><div class=\"oph_label\">"+_e9.label.replace(/[\[\]']+/g,"")+"</div>");return this;}});_3.define("Oph.field.Button",{extend:"Ext.Button",xtype:"oph_buttonfield",isField:true,config:{style:"display:block",baseCls:"x-field oph_group_btn oph_button",labelCls:"",isField:true,cls:"oph_link"},constructor:function(_ea){_ea=_ea||{};this.callParent([_ea]);},initialize:function(){this.callParent();},setValueData:function(_eb){this.setHtml("<div class=\""+_3c+"\" style=\""+_3d+"(/images/"+_eb.icon+".png);\"></div><div class=\"oph_label\">"+_eb.label.replace(/[\[\]']+/g,"")+"</div><span class=\"arrow\"></span>");return this;},getName:function(){return this.config.name;}});_3.define("Oph.field.Webview",{extend:"Ext.Container",xtype:"oph_webviewfield",constructor:function(_ec){_ec=_ec||{};this.callParent([_ec]);var _ed=58*Number(_ec.oph_height);if(_2b=="Phone"){_ed=52*Number(_ec.oph_height);}this.setHeight(_ed+18);this.setStyle("position:relative;padding:0.4em;");this.setHtml("<div class=\"oph_webview_mask\" style=\"z-index:999;position:absolute;top:0;left:0;width:100%;height:"+_ed+"px;\"></div>\t\t<div style=\"position:absolute;top:0;left:0;overflow:hidden;height:"+Number(_ed+20)+"px;width:100%;\"><iframe scrolling=\"no\" src=\""+_ec.url+"\" width=\"100%\" height=\""+_ed+"\" style=\"border:1px solid gray;\"></iframe></div>");},initialize:function(){this.callParent();},setValueData:function(_ee){}});_3.define("Oph.field.Video",{extend:"Ext.Video",xtype:"oph_videofield",constructor:function(_ef){_ef=_ef||{};this.callParent([_ef]);if(_ef.url.substr(0,4)!="http"&&_ef.url.substr(0,1)!="/"){_ef.url="/"+_ef.url;}},initialize:function(){this.callParent();this.ghost.setHtml("<div style=\"text-align:center;padding-top:1em;\">"+this.config.oph_label+"</div>");},setValueData:function(_f0){}});_3.define("Oph.field.Chart",{extend:"Ext.Container",xtype:"oph_chartfield",refreshInterval:null,constructor:function(_f1){_f1=_f1||{};var _f2="items";if(_f1.oph_type=="GroupItem"){_f2="groups";}_f1.img_src="/rrdchart.png?"+_f2+"="+_f1.oph_item+"&period="+_f1.oph_period;this.callParent([_f1]);this.setHtml("<div style=\"width:100%;padding:0.4em;\"><img id=\"img"+_f1.oph_id+"\" src=\""+_f1.img_src+"&random="+new Date().getTime()+"\" style=\"width:100%;\"></div>");},initialize:function(){this.callParent();this.on({painted:function(_f3){if(_f3.config.oph_refresh>0){_f3.config.refreshInterval=window.setInterval(function(){_f3.updateImage(_f3);},_f3.config.oph_refresh);}},erased:function(_f4){if(_f4.config.oph_refresh>0){window.clearInterval(_f4.config.refreshInterval);}}});},setValueData:function(_f5){},updateImage:function(_f6){_3.fly("img"+_f6.config.oph_id).dom.src=_f6.config.img_src+"&random="+new Date().getTime();}});_3.define("Oph.field.Image",{extend:"Ext.Container",xtype:"oph_imagefield",constructor:function(_f7){_f7=_f7||{};this.callParent([_f7]);if(_f7.url.substr(0,4)!="http"&&_f7.url.substr(0,1)!="/"){_f7.url="/"+_f7.url;}this.setHtml("<div style=\"width:100%;padding:0.4em;\"><img src=\""+_f7.url+"\" style=\"width:100%;\"></div>");},initialize:function(){this.callParent();},setValueData:function(_f8){}});_3.define("Oph.field.ImageLink",{extend:"Ext.Button",xtype:"oph_imagelink",config:{style:"display:block",baseCls:"none",labelCls:"",cls:"oph_link"},constructor:function(_f9){_f9=_f9||{};this.callParent([_f9]);if(_f9.url.substr(0,4)!="http"&&_f9.url.substr(0,1)!="/"){_f9.url="/"+_f9.url;}this.setHtml("<div style=\"width:100%;padding:0.4em;\"><img src=\""+_f9.url+"\" style=\"width:100%;\"></div>");},initialize:function(){this.callParent();},setValueData:function(_fa){}});_3.define("Oph.form.Panel",{extend:"Ext.Panel",xtype:"oph_formpanel",constructor:function(_fb){_fb=_fb||{};this.callParent([_fb]);},initialize:function(){this.callParent();},setValuesData:function(_fc){var _fd=this.getFields(),_fe,_ff,_100;_fc=_fc||{};_3.iterate(_fc,function(name,_101){if(_ff){_ff.setValueData(_101);}});return this;},getFields:function(_102){var _103={},_104;var _105=function(item){if(item.isField){_104=item.getName();if((_102&&_104==_102)||typeof _102=="undefined"){if(_103.hasOwnProperty(_104)){if(!_3.isArray(_103[_104])){_103[_104]=[_103[_104]];}_103[_104].push(item);}else{_103[_104]=item;}}}if(item.isContainer){item.items.each(_105);}};this.items.each(_105);return (_102)?(_103[_102]||[]):_103;}});function _7f(_106,_107,_108){return {xtype:"oph_sliderfield",minValue:0,maxValue:100,oph_item:_106,label:"<div class=\""+_3c+"\" style=\""+_3d+"(/images/"+_108+".png);\"></div><div class=\"oph_label\">"+_107.replace(/[\[\]']+/g,"")+"</div>"};};function _86(_109,_10a){return {xtype:"oph_textfield",html:_109.match(/\[(.*?)\]/)?_109.match(/\[(.*?)\]/)[1]:_109,label:"<div class=\""+_3c+"\" style=\""+_3d+"(/images/"+_10a+".png);\"></div><div class=\"oph_label\">"+_109.replace(/\[(.*?)\]/,"")+"</div>"};};function _7e(_10b,_10c,_10d){return {xtype:"oph_togglefield",oph_item:_10b,label:"<div class=\""+_3c+"\" style=\""+_3d+"(/images/"+_10d+".png);\"></div><div class=\"oph_label\">"+_10c.replace(/[\[\]']+/g,"")+"</div>"};};function _7c(_10e,_10f,_110){return {xtype:"oph_rollershutterfield",oph_item:_10e,label:"<div class=\""+_3c+"\" style=\""+_3d+"(/images/"+_110+".png);\"></div><div class=\"oph_label\">"+_10f.replace(/[\[\]']+/g,"")+"</div>"};};function _84(data){var _111=data.label;var _112;if(data.linkedPage){_112=data.linkedPage.id;}else{_112="none";}return {xtype:"oph_buttonfield",page_id:_112,page_label:_111};};function _88(url,_113,_114){return {xtype:"oph_imagelink",url:url,page_id:_113,page_label:_114};};function _87(_115,_116,_117,_118){return {xtype:"oph_selectfield",options:_116,oph_item:_115,usePicker:_3e,label:"<div class=\""+_3c+"\" style=\""+_3d+"(/images/"+_118+".png);\"></div><div class=\"oph_label\">"+_117.replace(/[\[\]']+/g,"")+"</div>"};};function _80(_119,_11a,_11b,_11c,_11d,_11e){return {xtype:"oph_setpointfield",oph_item:_119,minValue:Number(_11a),maxValue:Number(_11b),increment:Number(_11c),defaultValue:_11a,cycle:false,label:"<div class=\""+_3c+"\" style=\""+_3d+"(/images/"+_11e+".png);\"></div><div class=\"oph_label\">"+_11d.replace(/[\[\]']+/g,"")+"</div>"};};function _81(_11f,url,_120,_121){return {xtype:"oph_videofield",oph_item:_11f,url:url,width:"100%",height:"16em",style:"background-color:white;",posterUrl:"./app/video.png",oph_label:_120};};function _82(_122,url,_123,_124,_125){return {xtype:"oph_webviewfield",oph_item:_122,url:url,width:"100%",height:"16em",oph_label:_124,oph_height:_123};};function _7d(_126,_127,_128,_129){return {xtype:"oph_buttons_selectfield",options:_127,oph_item:_126,label:"<div class=\""+_3c+"\" style=\""+_3d+"(/images/"+_129+".png);\"></div><div class=\"oph_label\">"+_128.replace(/[\[\]']+/g,"")+"</div>"};};function _8a(){return {xtype:"field",label:"[UNSUPPORTED WIDGET]"};};function _89(url){return {xtype:"oph_imagefield",url:url,cls:"x-image-field"};};function _83(_12a,_12b,_12c,_12d,_12e,_12f,_130,_131,_132){return {xtype:"oph_chartfield",oph_item:_12a,oph_w:_12c,oph_h:_12d,oph_period:_12e,oph_refresh:_12f,oph_id:_12b,oph_type:_130,img_src:""};};_10=_3.application({name:"OpenHAB",requires:["MyApp.util.SizeMonitor","MyApp.util.PaintMonitor"],icon:"/images/icon.png",tabletStartupScreen:"/images/splash-ipad-v.png",phoneStartupScreen:"/images/splash-iphone.png",glossOnIcon:false,launch:function(){_44();_1b();_b3();if(_4.usePictogramIcons==true){_3c+=" oph_pictogram";_3d="-webkit-mask-image:url";}var _133=_3.create("Ext.Panel",{layout:{type:"card"},cls:"oph_background",fullscreen:true,id:"content",autoDestroy:true,items:[]});_133.onAfter("activeitemchange",function(_134,_135,_136,opts){if(_136){_136.removeAll(true);_136.destroy();}_135.on({tap:_9b,delegate:"button"});},_133);_133.onBefore("activeitemchange",function(_137,_138,_139,opts){_f=_138.getFields();_138.on({show:function(){var _13a=0;var _13b=0;var _13c=_138.getItems();if(_13c.length==1){_138.addCls("oph_widgets_container_one");}else{_138.addCls("oph_widgets_container_many");}_3.each(_13c.items,function(item){if(_13a>_13b){_13b+=item.element.dom.clientHeight;item.addCls(_36+"_fieldset_right");}else{_13a+=item.element.dom.clientHeight;item.addCls(_36+"_fieldset_left");}});}});_a0(_33[_33.length-1][0],"normal");},_133);if(_2b!="Phone"){_3a={type:"fade",duration:500};_39=_133.add(new _3.NestedList({docked:"left",width:"14em",scrollable:"auto",id:"leftPanel",styleHtmlContent:true,styleHtmlCls:"leftPanelContent",backText:_4a.back,updateTitleText:false,store:_64,listeners:{itemtap:_94},getItemTextTpl:function(node){return "<tpl if=\"icon\"><div class=\""+_3c+"\" style=\""+_3d+"(/images/{icon}.png);\"></div></tpl><div class=\"oph_label\">{text}</div><span class=\"arrow\"></span>";}}));_39.doBack=function(me,node,_13d,_13e){_33.pop();if(_30[_33[_33.length-1][0]].length>0){if(_37){me.getActiveItem().deselectAll();}else{this.goToNode(node.parentNode);}}else{_33.pop();this.goToNode(node.parentNode);}_37=false;_9a(_33[_33.length-1][0]);_99(_33[_33.length-1][0]);if(_33.length<=1){me.getBackButton().hide();}};}_133.add({docked:"top",xtype:"toolbar",ui:"light",items:[{id:"back_btn",ui:"back",text:_4a.back,handler:_9e,hidden:true},{xtype:"spacer"},{id:"title",xtype:"label",cls:"oph_title",centered:true,zIndex:0},{xtype:"spacer"},{id:"settings_btn",iconCls:"settings",iconMask:true,handler:_24}]});_38=localStorage.getItem("openHAB_sitemap");if(_38==""||_38==null||_38=="null"||_38=="choose"){_3b=new _3.Panel(_55);_3b.setCls(_36+"_modal");_3.Viewport.add(_3b);}else{_5a(_38);}}});function _2d(_13f){_33[_33.length-1][1]=_13f;_2f();};function _2f(){if(_2b=="Phone"){if(_33.length==1){_3.getCmp("back_btn").hide();}else{_3.getCmp("back_btn").show();}_34=_33[_33.length-1][1].replace(/[\[\]']+/g,"");}else{_34="";_3.each(_33,function(bc,k){_34+=bc[1].replace(/[\[\]']+/g,"");if(k!=_33.length-1){_34+=" > ";}});}_3.getCmp("title").setHtml(_34);};function _99(_140){_2c=_140;};}));