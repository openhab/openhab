(function(_1){if(typeof define==="function"&&define.amd){define(["jquery"],_1);}else{_1(jQuery);}}(function(_2){_2(window).bind("unload.atmosphere",function(){_2.atmosphere.debug(new Date()+" Atmosphere: "+"unload event");_2.atmosphere.unsubscribe();});_2(window).bind("beforeunload.atmosphere",function(){_2.atmosphere.debug(new Date()+" Atmosphere: "+"beforeunload event");_2.atmosphere._beforeUnloadState=true;setTimeout(function(){_2.atmosphere.debug(new Date()+" Atmosphere: "+"beforeunload event timeout reached. Reset _beforeUnloadState flag");_2.atmosphere._beforeUnloadState=false;},5000);});_2(window).bind("offline",function(){_2.atmosphere.offline=true;var _3=[].concat(_2.atmosphere.requests);for(var i=0;i<_3.length;i++){var rq=_3[i];rq.close();clearTimeout(rq.response.request.id);if(rq.heartbeatTimer){clearTimeout(rq.heartbeatTimer);}}});_2(window).bind("online",function(){_2.atmosphere.offline=false;if(_2.atmosphere.requests.length>0){for(var i=0;i<_2.atmosphere.requests.length;i++){_2.atmosphere.requests[i].init();_2.atmosphere.requests[i].execute();}}});_2(window).keypress(function(e){if(e.keyCode===27){e.preventDefault();}});var _4=function(_5){var _6,_7=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,_8={};while(_6=_7.exec(_5)){_8[_6[1]]=_6[2];}return _8;};_2.atmosphere={version:"2.2.12-jquery",uuid:0,offline:false,requests:[],callbacks:[],onError:function(_9){},onClose:function(_a){},onOpen:function(_b){},onMessage:function(_c){},onReconnect:function(_d,_e){},onMessagePublished:function(_f){},onTransportFailure:function(_10,_11){},onLocalMessage:function(_12){},onClientTimeout:function(_13){},onFailureToReconnect:function(_14,_15){},WebsocketApiAdapter:function(_16){var _17,_18;_16.onMessage=function(e){_18.onmessage({data:e.responseBody});};_16.onMessagePublished=function(e){_18.onmessage({data:e.responseBody});};_16.onOpen=function(e){_18.onopen(e);};_18={close:function(){_17.close();},send:function(_19){_17.push(_19);},onmessage:function(e){},onopen:function(e){},onclose:function(e){},onerror:function(e){}};_17=new $.atmosphere.subscribe(_16);return _18;},AtmosphereRequest:function(_1a){var _1b={timeout:300000,method:"GET",headers:{},contentType:"",callback:null,url:"",data:"",suspend:true,maxRequest:-1,reconnect:true,maxStreamingLength:10000000,lastIndex:0,logLevel:"info",requestCount:0,fallbackMethod:"GET",fallbackTransport:"streaming",transport:"long-polling",webSocketImpl:null,webSocketBinaryType:null,dispatchUrl:null,webSocketPathDelimiter:"@@",enableXDR:false,rewriteURL:false,attachHeadersAsQueryString:true,executeCallbackBeforeReconnect:false,readyState:0,withCredentials:false,trackMessageLength:false,messageDelimiter:"|",connectTimeout:-1,reconnectInterval:0,dropHeaders:true,uuid:0,shared:false,readResponsesHeaders:false,maxReconnectOnClose:5,enableProtocol:true,pollingInterval:0,heartbeat:{client:null,server:null},ackInterval:0,closeAsync:false,reconnectOnServerError:true,onError:function(_1c){},onClose:function(_1d){},onOpen:function(_1e){},onMessage:function(_1f){},onReopen:function(_20,_21){},onReconnect:function(_22,_23){},onMessagePublished:function(_24){},onTransportFailure:function(_25,_26){},onLocalMessage:function(_27){},onFailureToReconnect:function(_28,_29){},onClientTimeout:function(_2a){}};var _2b={status:200,reasonPhrase:"OK",responseBody:"",messages:[],headers:[],state:"messageReceived",transport:"polling",error:null,request:null,partialMessage:"",errorHandled:false,closedByClientTimeout:false,ffTryingReconnect:false};var _2c=null;var _2d=null;var _2e=null;var _2f=null;var _30=null;var _31=true;var _32=0;var _33=0;var _34="X";var _35=false;var _36=null;var _37;var _38=null;var _39=_2.now();var _3a;var _3b;var _3c=false;_3d(_1a);function _3e(){_31=true;_35=false;_32=0;_2c=null;_2d=null;_2e=null;_2f=null;};function _3f(){_40();_3e();};function _41(_42){if(_42=="debug"){return _1b.logLevel==="debug";}else{if(_42=="info"){return _1b.logLevel==="info"||_1b.logLevel==="debug";}else{if(_42=="warn"){return _1b.logLevel==="warn"||_1b.logLevel==="info"||_1b.logLevel==="debug";}else{if(_42=="error"){return _1b.logLevel==="error"||_1b.logLevel==="warn"||_1b.logLevel==="info"||_1b.logLevel==="debug";}else{return false;}}}}};function _43(msg){if(_41("debug")){_2.atmosphere.debug(new Date()+" Atmosphere: "+msg);}};function _3d(_44){_3f();_1b=_2.extend(_1b,_44);_1b.mrequest=_1b.reconnect;if(!_1b.reconnect){_1b.reconnect=true;}};function _45(){return _1b.webSocketImpl!=null||window.WebSocket||window.MozWebSocket;};function _46(){function _47(url){var div=document.createElement("div");div.innerHTML="<a href=\""+url+"\"/>";return encodeURI(decodeURI(div.firstChild.href));};var url=_47(_1b.url.toLowerCase());var _48=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/.exec(url);var _49=!!(_48&&(_48[1]!=window.location.protocol||_48[2]!=window.location.hostname||(_48[3]||(_48[1]==="http:"?80:443))!=(window.location.port||(window.location.protocol==="http:"?80:443))));return window.EventSource&&(!_49||!_2.browser.safari||_2.browser.vmajor>=7);};function _4a(){if(_1b.shared){_38=_4b(_1b);if(_38!=null){if(_41("debug")){_2.atmosphere.debug("Storage service available. All communication will be local");}if(_38.open(_1b)){return;}}if(_41("debug")){_2.atmosphere.debug("No Storage service available.");}_38=null;}_1b.firstMessage=_2.atmosphere.uuid==0?true:false;_1b.isOpen=false;_1b.ctime=_2.now();if(_1b.uuid===0){_1b.uuid=_2.atmosphere.uuid;}_1b.closedByClientTimeout=false;if(_1b.transport!=="websocket"&&_1b.transport!=="sse"){_4c(_1b);}else{if(_1b.transport==="websocket"){if(!_45()){_4d("Websocket is not supported, using request.fallbackTransport ("+_1b.fallbackTransport+")");}else{_4e(false);}}else{if(_1b.transport==="sse"){if(!_46()){_4d("Server Side Events(SSE) is not supported, using request.fallbackTransport ("+_1b.fallbackTransport+")");}else{_4f(false);}}}}};function _4b(_50){var _51,_52,_53,_54="atmosphere-"+_50.url,_55={storage:function(){if(!_2.atmosphere.supportStorage()){return;}var _56=window.localStorage,get=function(key){return _2.parseJSON(_56.getItem(_54+"-"+key));},set=function(key,_57){_56.setItem(_54+"-"+key,_2.stringifyJSON(_57));};return {init:function(){set("children",get("children").concat([_39]));_2(window).on("storage.socket",function(_58){_58=_58.originalEvent;if(_58.key===_54&&_58.newValue){_62(_58.newValue);}});return get("opened");},signal:function(_59,_5a){_56.setItem(_54,_2.stringifyJSON({target:"p",type:_59,data:_5a}));},close:function(){var _5b,_5c=get("children");_2(window).off("storage.socket");if(_5c){_5b=_2.inArray(_50.id,_5c);if(_5b>-1){_5c.splice(_5b,1);set("children",_5c);}}}};},windowref:function(){var win=window.open("",_54.replace(/\W/g,""));if(!win||win.closed||!win.callbacks){return;}return {init:function(){win.callbacks.push(_62);win.children.push(_39);return win.opened;},signal:function(_5d,_5e){if(!win.closed&&win.fire){win.fire(_2.stringifyJSON({target:"p",type:_5d,data:_5e}));}},close:function(){function _5f(_60,e){var _61=_2.inArray(e,_60);if(_61>-1){_60.splice(_61,1);}};if(!_53){_5f(win.callbacks,_62);_5f(win.children,_39);}}};}};function _62(_63){var _64=_2.parseJSON(_63),_65=_64.data;if(_64.target==="c"){switch(_64.type){case "open":_80("opening","local",_1b);break;case "close":if(!_53){_53=true;if(_65.reason==="aborted"){_84();}else{if(_65.heir===_39){_4a();}else{setTimeout(function(){_4a();},100);}}}break;case "message":_11d(_65,"messageReceived",200,_50.transport);break;case "localMessage":_11b(_65);break;}}};function _66(){var _67=new RegExp("(?:^|; )("+encodeURIComponent(_54)+")=([^;]*)").exec(document.cookie);if(_67){return _2.parseJSON(decodeURIComponent(_67[2]));}};_51=_66();if(!_51||_2.now()-_51.ts>1000){return;}_52=_55.storage()||_55.windowref();if(!_52){return;}return {open:function(){var _68;_3a=setInterval(function(){var _69=_51;_51=_66();if(!_51||_69.ts===_51.ts){_62(_2.stringifyJSON({target:"c",type:"close",data:{reason:"error",heir:_69.heir}}));}},1000);_68=_52.init();if(_68){setTimeout(function(){_80("opening","local",_50);},50);}return _68;},send:function(_6a){_52.signal("send",_6a);},localSend:function(_6b){_52.signal("localSend",_2.stringifyJSON({id:_39,event:_6b}));},close:function(){if(!_35){clearInterval(_3a);_52.signal("close");_52.close();}}};};function _6c(){var _6d,_6e="atmosphere-"+_1b.url,_6f={storage:function(){if(!_2.atmosphere.supportStorage()){return;}var _70=window.localStorage;return {init:function(){_2(window).on("storage.socket",function(_71){_71=_71.originalEvent;if(_71.key===_6e&&_71.newValue){_7a(_71.newValue);}});},signal:function(_72,_73){_70.setItem(_6e,_2.stringifyJSON({target:"c",type:_72,data:_73}));},get:function(key){return _2.parseJSON(_70.getItem(_6e+"-"+key));},set:function(key,_74){_70.setItem(_6e+"-"+key,_2.stringifyJSON(_74));},close:function(){_2(window).off("storage.socket");_70.removeItem(_6e);_70.removeItem(_6e+"-opened");_70.removeItem(_6e+"-children");}};},windowref:function(){var _75=_6e.replace(/\W/g,""),win=(_2("iframe[name=\""+_75+"\"]")[0]||_2("<iframe name=\""+_75+"\" />").hide().appendTo("body")[0]).contentWindow;return {init:function(){win.callbacks=[_7a];win.fire=function(_76){var i;for(i=0;i<win.callbacks.length;i++){win.callbacks[i](_76);}};},signal:function(_77,_78){if(!win.closed&&win.fire){win.fire(_2.stringifyJSON({target:"c",type:_77,data:_78}));}},get:function(key){return !win.closed?win[key]:null;},set:function(key,_79){if(!win.closed){win[key]=_79;}},close:function(){}};}};function _7a(_7b){var _7c=_2.parseJSON(_7b),_7d=_7c.data;if(_7c.target==="p"){switch(_7c.type){case "send":_be(_7d);break;case "localSend":_11b(_7d);break;case "close":_84();break;}}};_36=function propagateMessageEvent(_7e){_6d.signal("message",_7e);};function _7f(){document.cookie=_3b+"="+encodeURIComponent(_2.stringifyJSON({ts:_2.now()+1,heir:(_6d.get("children")||[])[0]}))+"; path=/";};_6d=_6f.storage()||_6f.windowref();_6d.init();if(_41("debug")){_2.atmosphere.debug("Installed StorageService "+_6d);}_6d.set("children",[]);if(_6d.get("opened")!=null&&!_6d.get("opened")){_6d.set("opened",false);}_3b=encodeURIComponent(_6e);_7f();_3a=setInterval(_7f,1000);_37=_6d;};function _80(_81,_82,_83){if(_1b.shared&&_82!=="local"){_6c();}if(_37!=null){_37.set("opened",true);}_83.close=function(){_84();};if(_32>0&&_81==="re-connecting"){_83.isReopen=true;_85(_2b);}else{if(_2b.error==null){_2b.request=_83;var _86=_2b.state;_2b.state=_81;var _87=_2b.transport;_2b.transport=_82;var _88=_2b.responseBody;_89();_2b.responseBody=_88;_2b.state=_86;_2b.transport=_87;}}};function _8a(_8b){_8b.transport="jsonp";var rq=_1b;if((_8b!=null)&&(typeof (_8b)!=="undefined")){rq=_8b;}var url=rq.url;if(rq.dispatchUrl!=null){url+=rq.dispatchUrl;}var _8c=rq.data;if(rq.attachHeadersAsQueryString){url=_8d(rq);if(_8c!==""){url+="&X-Atmosphere-Post-Body="+encodeURIComponent(_8c);}_8c="";}_30=_2.ajax({url:url,type:rq.method,dataType:"jsonp",error:function(_8e,_8f,_90){_2b.error=true;if(rq.openId){clearTimeout(rq.openId);}if(rq.heartbeatTimer){clearTimeout(rq.heartbeatTimer);}if(rq.reconnect&&_32++<rq.maxReconnectOnClose){_80("re-connecting",rq.transport,rq);_e8(_30,rq,rq.reconnectInterval);rq.openId=setTimeout(function(){_bd(rq);},rq.reconnectInterval+1000);}else{_a7(_8e.status,_90);}},jsonp:"jsonpTransport",success:function(_91){if(rq.reconnect){if(rq.maxRequest===-1||rq.requestCount++<rq.maxRequest){_e2(_30,rq);var msg=_91.message;if(msg!=null&&typeof msg!=="string"){try{msg=_2.stringifyJSON(msg);}catch(err){}}var _92=_c6(msg,rq,_2b);if(!rq.executeCallbackBeforeReconnect){_e8(_30,rq,rq.pollingInterval);}if(!_92){_11d(_2b.responseBody,"messageReceived",200,rq.transport);}if(rq.executeCallbackBeforeReconnect){_e8(_30,rq,rq.pollingInterval);}_bf(rq);}else{_2.atmosphere.log(_1b.logLevel,["JSONP reconnect maximum try reached "+_1b.requestCount]);_a7(0,"maxRequest reached");}}},data:rq.data,beforeSend:function(_93){_94(_93,rq,false);}});};function _95(_96){var rq=_1b;if((_96!=null)&&(typeof (_96)!=="undefined")){rq=_96;}var url=rq.url;if(rq.dispatchUrl!=null){url+=rq.dispatchUrl;}var _97=rq.data;if(rq.attachHeadersAsQueryString){url=_8d(rq);if(_97!==""){url+="&X-Atmosphere-Post-Body="+encodeURIComponent(_97);}_97="";}var _98=typeof (rq.async)!=="undefined"?rq.async:true;_30=_2.ajax({url:url,type:rq.method,error:function(_99,_9a,_9b){_2b.error=true;if(_99.status<300){_e8(_30,rq);}else{_a7(_99.status,_9b);}},success:function(_9c,_9d,_9e){if(rq.reconnect){if(rq.maxRequest===-1||rq.requestCount++<rq.maxRequest){if(!rq.executeCallbackBeforeReconnect){_e8(_30,rq,rq.pollingInterval);}var _9f=_c6(_9c,rq,_2b);if(!_9f){_11d(_2b.responseBody,"messageReceived",200,rq.transport);}if(rq.executeCallbackBeforeReconnect){_e8(_30,rq,rq.pollingInterval);}}else{_2.atmosphere.log(_1b.logLevel,["AJAX reconnect maximum try reached "+_1b.requestCount]);_a7(0,"maxRequest reached");}}},beforeSend:function(_a0){_94(_a0,rq,false);},crossDomain:rq.enableXDR,async:_98});};function _a1(_a2){if(_1b.webSocketImpl!=null){return _1b.webSocketImpl;}else{if(window.WebSocket){return new WebSocket(_a2);}else{return new MozWebSocket(_a2);}}};function _a3(){var url=_8d(_1b);return decodeURI(_2("<a href=\""+url+"\"/>")[0].href.replace(/^http/,"ws"));};function _a4(){var url=_8d(_1b);return url;};function _4f(_a5){_2b.transport="sse";var _a6=_a4(_1b.url);if(_41("debug")){_2.atmosphere.debug("Invoking executeSSE");_2.atmosphere.debug("Using URL: "+_a6);}if(_a5&&!_1b.reconnect){if(_2d!=null){_40();}return;}try{_2d=new EventSource(_a6,{withCredentials:_1b.withCredentials});}catch(e){_a7(0,e);_4d("SSE failed. Downgrading to fallback transport and resending");return;}if(_1b.connectTimeout>0){_1b.id=setTimeout(function(){if(!_a5){_40();}},_1b.connectTimeout);}_2d.onopen=function(_a8){_43("websocket.onopen");_bf(_1b);if(_41("debug")){_2.atmosphere.debug("SSE successfully opened");}if(!_1b.enableProtocol){if(!_a5){_80("opening","sse",_1b);}else{_80("re-opening","sse",_1b);}}else{if(_1b.isReopen){_1b.isReopen=false;_80("re-opening",_1b.transport,_1b);}}_a5=true;if(_1b.method==="POST"){_2b.state="messageReceived";_2d.send(_1b.data);}};_2d.onmessage=function(_a9){_43("websocket.onmessage");_bf(_1b);if(!_1b.enableXDR&&_a9.origin!==window.location.protocol+"//"+window.location.host){_2.atmosphere.log(_1b.logLevel,["Origin was not "+window.location.protocol+"//"+window.location.host]);return;}_2b.state="messageReceived";_2b.status=200;_a9=_a9.data;var _aa=_c6(_a9,_1b,_2b);if(!_aa){_89();_2b.responseBody="";_2b.messages=[];}};_2d.onerror=function(_ab){_43("websocket.onerror");clearTimeout(_1b.id);if(_1b.heartbeatTimer){clearTimeout(_1b.heartbeatTimer);}if(_2b.closedByClientTimeout){return;}_108(_a5);_40();if(_35){_2.atmosphere.log(_1b.logLevel,["SSE closed normally"]);}else{if(!_a5){_4d("SSE failed. Downgrading to fallback transport and resending");}else{if(_1b.reconnect&&(_2b.transport==="sse")){if(_32++<_1b.maxReconnectOnClose){_80("re-connecting",_1b.transport,_1b);if(_1b.reconnectInterval>0){_1b.reconnectId=setTimeout(function(){_4f(true);},_1b.reconnectInterval);}else{_4f(true);}_2b.responseBody="";_2b.messages=[];}else{_2.atmosphere.log(_1b.logLevel,["SSE reconnect maximum try reached "+_32]);_a7(0,"maxReconnectOnClose reached");}}}}};};function _4e(_ac){_2b.transport="websocket";var _ad=_a3(_1b.url);if(_41("debug")){_2.atmosphere.debug("Invoking executeWebSocket");_2.atmosphere.debug("Using URL: "+_ad);}if(_ac&&!_1b.reconnect){if(_2c!=null){_40();}return;}_2c=_a1(_ad);if(_1b.webSocketBinaryType!=null){_2c.binaryType=_1b.webSocketBinaryType;}if(_1b.connectTimeout>0){_1b.id=setTimeout(function(){if(!_ac){var _ae={code:1002,reason:"",wasClean:false};_2c.onclose(_ae);try{_40();}catch(e){}return;}},_1b.connectTimeout);}_2c.onopen=function(_af){_43("websocket.onopen");_bf(_1b);if(_41("debug")){_2.atmosphere.debug("Websocket successfully opened");}_2.atmosphere.offline=false;var _b0=_ac;if(_2c!=null){_2c.canSendMessage=true;}if(!_1b.enableProtocol){_ac=true;if(_b0){_80("re-opening","websocket",_1b);}else{_80("opening","websocket",_1b);}}if(_2c!=null){if(_1b.method==="POST"){_2b.state="messageReceived";_2c.send(_1b.data);}}};_2c.onmessage=function(_b1){_43("websocket.onmessage: "+_b1);_bf(_1b);if(_1b.enableProtocol){_ac=true;}_2b.state="messageReceived";_2b.status=200;_b1=_b1.data;var _b2=typeof (_b1)==="string";if(_b2){var _b3=_c6(_b1,_1b,_2b);if(!_b3){_89();_2b.responseBody="";_2b.messages=[];}}else{_b1=_b8(_1b,_b1);if(_b1===""){return;}_2b.responseBody=_b1;_89();_2b.responseBody=null;}};_2c.onerror=function(_b4){_43("websocket.onerror");clearTimeout(_1b.id);if(_1b.heartbeatTimer){clearTimeout(_1b.heartbeatTimer);}};_2c.onclose=function(_b5){_43("websocket.onclose");if(_2b.state==="closed"){return;}clearTimeout(_1b.id);var _b6=_b5.reason;if(_b6===""){switch(_b5.code){case 1000:_b6="Normal closure; the connection successfully completed whatever purpose for which it was created.";break;case 1001:_b6="The endpoint is going away, either because of a server failure or because the "+"browser is navigating away from the page that opened the connection.";break;case 1002:_b6="The endpoint is terminating the connection due to a protocol error.";break;case 1003:_b6="The connection is being terminated because the endpoint received data of a type it "+"cannot accept (for example, a text-only endpoint received binary data).";break;case 1004:_b6="The endpoint is terminating the connection because a data frame was received that is too large.";break;case 1005:_b6="Unknown: no status code was provided even though one was expected.";break;case 1006:_b6="Connection was closed abnormally (that is, with no close frame being sent).";break;}}if(_41("warn")){_2.atmosphere.warn("Websocket closed, reason: "+_b6);_2.atmosphere.warn("Websocket closed, wasClean: "+_b5.wasClean);}if(_2b.closedByClientTimeout||_2.atmosphere.offline){if(_1b.reconnectId){clearTimeout(_1b.reconnectId);delete _1b.reconnectId;}return;}_108(_ac);_2b.state="closed";if(_35){_2.atmosphere.log(_1b.logLevel,["Websocket closed normally"]);}else{if(!_ac){_4d("Websocket failed. Downgrading to Comet and resending");}else{if(_1b.reconnect&&_2b.transport==="websocket"){_40();if(_32++<_1b.maxReconnectOnClose){_80("re-connecting",_1b.transport,_1b);if(_1b.reconnectInterval>0){_1b.reconnectId=setTimeout(function(){_2b.responseBody="";_2b.messages=[];_4e(true);},_1b.reconnectInterval);}else{_2b.responseBody="";_2b.messages=[];_4e(true);}}else{_2.atmosphere.log(_1b.logLevel,["Websocket reconnect maximum try reached "+_1b.requestCount]);if(_41("warn")){_2.atmosphere.warn("Websocket error, reason: "+_b5.reason);}_a7(0,"maxReconnectOnClose reached");}}}}};var ua=navigator.userAgent.toLowerCase();var _b7=ua.indexOf("android")>-1;if(_b7&&_2c.url===undefined){_2c.onclose({reason:"Android 4.1 does not support websockets.",wasClean:false});}};function _b8(_b9,_ba){var _bb=_ba;if(_b9.transport==="polling"){return _bb;}if(_b9.enableProtocol&&_b9.firstMessage&&_2.trim(_ba).length!==0){var pos=_b9.trackMessageLength?1:0;var _bc=_ba.split(_b9.messageDelimiter);if(_bc.length<=pos+1){return _bb;}_b9.firstMessage=false;_b9.uuid=_2.trim(_bc[pos]);if(_bc.length<=pos+2){_2.atmosphere.log("error",["Protocol data not sent by the server. "+"If you enable protocol on client side, be sure to install JavascriptProtocol interceptor on server side."+"Also note that atmosphere-runtime 2.2+ should be used."]);}_33=parseInt(_2.trim(_bc[pos+1]),10);_34=_bc[pos+2];b=false;if(_b9.transport!=="long-polling"){_bd(_b9);}_2.atmosphere.uuid=_b9.uuid;_bb="";pos=_b9.trackMessageLength?4:3;if(_bc.length>pos+1){for(var i=pos;i<_bc.length;i++){_bb+=_bc[i];if(i+1!==_bc.length){_bb+=_b9.messageDelimiter;}}}if(_b9.ackInterval!==0){setTimeout(function(){_be("...ACK...");},_b9.ackInterval);}}else{if(_b9.enableProtocol&&_b9.firstMessage&&_2.browser.msie&&+_2.browser.version.split(".")[0]<10){_2.atmosphere.log(_1b.logLevel,["Receiving unexpected data from IE"]);}else{_bd(_b9);}}return _bb;};function _bf(_c0){clearTimeout(_c0.id);if(_c0.timeout>0&&_c0.transport!=="polling"){_c0.id=setTimeout(function(){_c1(_c0);_c2();_40();},_c0.timeout);}};function _c1(_c3){_2b.closedByClientTimeout=true;_2b.state="closedByClient";_2b.responseBody="";_2b.status=408;_2b.messages=[];_89();};function _a7(_c4,_c5){_40();clearTimeout(_1b.id);_2b.state="error";_2b.reasonPhrase=_c5;_2b.responseBody="";_2b.status=_c4;_2b.messages=[];_89();};function _c6(_c7,_c8,_c9){_c7=_b8(_c8,_c7);if(_c7.length===0){return true;}_c9.responseBody=_c7;if(_c8.trackMessageLength){_c7=_c9.partialMessage+_c7;var _ca=[];var _cb=_c7.indexOf(_c8.messageDelimiter);if(_cb!=-1){while(_cb!==-1){var str=_c7.substring(0,_cb);var _cc=parseInt(str,10);if(isNaN(_cc)){throw "message length \""+str+"\" is not a number";}_cb+=_c8.messageDelimiter.length;if(_cb+_cc>_c7.length){_cb=-1;}else{_ca.push(_c7.substring(_cb,_cb+_cc));_c7=_c7.substring(_cb+_cc,_c7.length);_cb=_c7.indexOf(_c8.messageDelimiter);}}_c9.partialMessage=_c7;if(_ca.length!==0){_c9.responseBody=_ca.join(_c8.messageDelimiter);_c9.messages=_ca;return false;}else{_c9.responseBody="";_c9.messages=[];return true;}}}_c9.responseBody=_c7;_c9.messages=[_c7];return false;};function _4d(_cd){_2.atmosphere.log(_1b.logLevel,[_cd]);if(typeof (_1b.onTransportFailure)!=="undefined"){_1b.onTransportFailure(_cd,_1b);}else{if(typeof (_2.atmosphere.onTransportFailure)!=="undefined"){_2.atmosphere.onTransportFailure(_cd,_1b);}}_1b.transport=_1b.fallbackTransport;var _ce=_1b.connectTimeout===-1?0:_1b.connectTimeout;if(_1b.reconnect&&_1b.transport!=="none"||_1b.transport==null){_1b.method=_1b.fallbackMethod;_2b.transport=_1b.fallbackTransport;_1b.fallbackTransport="none";if(_ce>0){_1b.reconnectId=setTimeout(function(){_4a();},_ce);}else{_4a();}}else{_a7(500,"Unable to reconnect with fallback transport");}};function _8d(_cf,url){var rq=_1b;if((_cf!=null)&&(typeof (_cf)!=="undefined")){rq=_cf;}if(url==null){url=rq.url;}if(!rq.attachHeadersAsQueryString){return url;}if(url.indexOf("X-Atmosphere-Framework")!==-1){return url;}url+=(url.indexOf("?")!==-1)?"&":"?";url+="X-Atmosphere-tracking-id="+rq.uuid;url+="&X-Atmosphere-Framework="+_2.atmosphere.version;url+="&X-Atmosphere-Transport="+rq.transport;if(rq.trackMessageLength){url+="&X-Atmosphere-TrackMessageSize="+"true";}if(rq.heartbeat!==null&&rq.heartbeat.server!==null){url+="&X-Heartbeat-Server="+rq.heartbeat.server;}if(rq.contentType!==""){url+="&Content-Type="+(rq.transport==="websocket"?rq.contentType:encodeURIComponent(rq.contentType));}if(rq.enableProtocol){url+="&X-atmo-protocol=true";}_2.each(rq.headers,function(_d0,_d1){var h=_2.isFunction(_d1)?_d1.call(this,rq,_cf,_2b):_d1;if(h!=null){url+="&"+encodeURIComponent(_d0)+"="+encodeURIComponent(h);}});return url;};function _bd(rq){if(!rq.isOpen){rq.isOpen=true;_80("opening",rq.transport,rq);}else{if(rq.isReopen){rq.isReopen=false;_80("re-opening",rq.transport,rq);}else{return;}}_d2(rq);};function _d2(rq){if(rq.heartbeatTimer!=null){clearTimeout(rq.heartbeatTimer);}if(!isNaN(_33)&&_33>0){var _d3=function(){if(_41("debug")){_2.atmosphere.debug("Sending heartbeat");}_be(_34);rq.heartbeatTimer=setTimeout(_d3,_33);};rq.heartbeatTimer=setTimeout(_d3,_33);}};function _4c(_d4){var rq=_1b;if((_d4!=null)||(typeof (_d4)!=="undefined")){rq=_d4;}rq.lastIndex=0;rq.readyState=0;if((rq.transport==="jsonp")||((rq.enableXDR)&&(_2.atmosphere.checkCORSSupport()))){_8a(rq);return;}if(rq.transport==="ajax"){_95(_d4);return;}if(_2.browser.msie&&+_2.browser.version.split(".")[0]<10){if((rq.transport==="streaming")){if(rq.enableXDR&&window.XDomainRequest){_d5(rq);}else{_d6(rq);}return;}if((rq.enableXDR)&&(window.XDomainRequest)){_d5(rq);return;}}var _d7=function(_d8){rq.lastIndex=0;if(_d8||(rq.reconnect&&_32++<rq.maxReconnectOnClose)){_2b.ffTryingReconnect=true;_80("re-connecting",_d4.transport,_d4);_e8(_d9,rq,_d4.reconnectInterval);}else{_a7(0,"maxReconnectOnClose reached");}};var _da=function(_db){if(_2.atmosphere._beforeUnloadState){_2.atmosphere.debug(new Date()+" Atmosphere: reconnectF: execution delayed due to _beforeUnloadState flag");setTimeout(function(){_d7(_db);},5000);}else{_d7(_db);}};var _dc=function(){_2b.errorHandled=true;_40();_da(false);};if(rq.reconnect&&(rq.maxRequest===-1||rq.requestCount++<rq.maxRequest)){var _d9=_2.ajaxSettings.xhr();_d9.hasData=false;_94(_d9,rq,true);if(rq.suspend){_2e=_d9;}if(rq.transport!=="polling"){_2b.transport=rq.transport;_d9.onabort=function(){_43("ajaxrequest.onabort");_108(true);};_d9.onerror=function(){_43("ajaxrequest.onerror");_2b.error=true;_2b.ffTryingReconnect=true;try{_2b.status=XMLHttpRequest.status;}catch(e){_2b.status=500;}if(!_2b.status){_2b.status=500;}if(!_2b.errorHandled){_40();_da(false);}};}_d9.onreadystatechange=function(){_43("ajaxRequest.onreadystatechange, new state: "+_d9.readyState);if(_35){return;}_2b.error=null;var _dd=false;var _de=false;if(rq.transport==="streaming"&&rq.readyState>2&&_d9.readyState===4){_40();_da(false);return;}rq.readyState=_d9.readyState;if(rq.transport==="streaming"&&_d9.readyState>=3){_de=true;}else{if(rq.transport==="long-polling"&&_d9.readyState===4){_de=true;}}_bf(_1b);if(rq.transport!=="polling"){var _df=200;if(_d9.readyState===4){_df=_d9.status>1000?0:_d9.status;}if(!rq.reconnectOnServerError&&(_df>=300&&_df<600)){_a7(_df,_d9.statusText);return;}if(_df>=300||_df===0){_dc();return;}if((!rq.enableProtocol||!_d4.firstMessage)&&_d9.readyState===2){if(_2.browser.mozilla&&_2b.ffTryingReconnect){_2b.ffTryingReconnect=false;setTimeout(function(){if(!_2b.ffTryingReconnect){_bd(rq);}},500);}else{_bd(rq);}}}else{if(_d9.readyState===4){_de=true;}}if(_de){var _e0=_d9.responseText;if(rq.transport==="long-polling"&&_2.trim(_e0).length===0){if(!_d9.hasData){_da(true);}else{_d9.hasData=false;}return;}_d9.hasData=true;_e2(_d9,_1b);if(rq.transport==="streaming"){if(!_2.browser.opera){var _e1=_e0.substring(rq.lastIndex,_e0.length);_dd=_c6(_e1,rq,_2b);rq.lastIndex=_e0.length;if(_dd){return;}}else{_2.atmosphere.iterate(function(){if(_2b.status!==500&&_d9.responseText.length>rq.lastIndex){try{_2b.status=_d9.status;_2b.headers=_4(_d9.getAllResponseHeaders());_e2(_d9,_1b);}catch(e){_2b.status=404;}_bf(_1b);_2b.state="messageReceived";var _e3=_d9.responseText.substring(rq.lastIndex);rq.lastIndex=_d9.responseText.length;_dd=_c6(_e3,rq,_2b);if(!_dd){_89();}if(_e4(_d9,rq)){_e5(_d9,rq);return;}}else{if(_2b.status>400){rq.lastIndex=_d9.responseText.length;return false;}}},0);}}else{_dd=_c6(_e0,rq,_2b);}var _e6=_e4(_d9,rq);try{_2b.status=_d9.status;_2b.headers=_4(_d9.getAllResponseHeaders());_e2(_d9,rq);}catch(e){_2b.status=404;}if(rq.suspend){_2b.state=_2b.status===0?"closed":"messageReceived";}else{_2b.state="messagePublished";}var _e7=!_e6&&_d4.transport!=="streaming"&&_d4.transport!=="polling";if(_e7&&!rq.executeCallbackBeforeReconnect){_e8(_d9,rq,rq.pollingInterval);}if(_2b.responseBody.length!==0&&!_dd){_89();}if(_e7&&rq.executeCallbackBeforeReconnect){_e8(_d9,rq,rq.pollingInterval);}if(_e6){_e5(_d9,rq);}}};_d9.send(rq.data);_31=true;}else{if(rq.logLevel==="debug"){_2.atmosphere.log(rq.logLevel,["Max re-connection reached."]);}_a7(0,"maxRequest reached");}};function _e5(_e9,rq){_2b.messages=[];rq.isReopen=true;_84();_35=false;_e8(_e9,rq,500);};function _94(_ea,_eb,_ec){var url=_eb.url;if(_eb.dispatchUrl!=null&&_eb.method==="POST"){url+=_eb.dispatchUrl;}url=_8d(_eb,url);url=_2.atmosphere.prepareURL(url);if(_ec){_ea.open(_eb.method,url,true);if(_eb.connectTimeout>0){_eb.id=setTimeout(function(){if(_eb.requestCount===0){_40();_11d("Connect timeout","closed",200,_eb.transport);}},_eb.connectTimeout);}}if(_1b.withCredentials&&_1b.transport!=="websocket"){if("withCredentials" in _ea){_ea.withCredentials=true;}}if(!_1b.dropHeaders){_ea.setRequestHeader("X-Atmosphere-Framework",_2.atmosphere.version);_ea.setRequestHeader("X-Atmosphere-Transport",_eb.transport);if(_eb.heartbeat!==null&&_eb.heartbeat.server!==null){_ea.setRequestHeader("X-Heartbeat-Server",_ea.heartbeat.server);}if(_eb.trackMessageLength){_ea.setRequestHeader("X-Atmosphere-TrackMessageSize","true");}_ea.setRequestHeader("X-Atmosphere-tracking-id",_eb.uuid);_2.each(_eb.headers,function(_ed,_ee){var h=_2.isFunction(_ee)?_ee.call(this,_ea,_eb,_ec,_2b):_ee;if(h!=null){_ea.setRequestHeader(_ed,h);}});}if(_eb.contentType!==""){_ea.setRequestHeader("Content-Type",_eb.contentType);}};function _e8(_ef,_f0,_f1){if(_2b.closedByClientTimeout){return;}if(_f0.reconnect||(_f0.suspend&&_31)){var _f2=0;if(_ef.readyState>1){_f2=_ef.status>1000?0:_ef.status;}_2b.status=_f2===0?204:_f2;_2b.reason=_f2===0?"Server resumed the connection or down.":"OK";clearTimeout(_f0.id);if(_f0.reconnectId){clearTimeout(_f0.reconnectId);delete _f0.reconnectId;}if(_f1>0){setTimeout(function(){_1b.reconnectId=_4c(_f0);},_f1);}else{_4c(_f0);}}};function _85(_f3){_f3.state="re-connecting";_f4(_f3);};function _d5(_f5){if(_f5.transport!=="polling"){_2f=_f6(_f5);_2f.open();}else{_f6(_f5).open();}};function _f6(_f7){var rq=_1b;if((_f7!=null)&&(typeof (_f7)!=="undefined")){rq=_f7;}var _f8=rq.transport;var _f9=0;var xdr=new window.XDomainRequest();var _fa=function(){if(rq.transport==="long-polling"&&(rq.reconnect&&(rq.maxRequest===-1||rq.requestCount++<rq.maxRequest))){xdr.status=200;_80("re-connecting",_f7.transport,_f7);_d5(rq);}};var _fb=rq.rewriteURL||function(url){var _fc=/(?:^|;\s*)(JSESSIONID|PHPSESSID)=([^;]*)/.exec(document.cookie);switch(_fc&&_fc[1]){case "JSESSIONID":return url.replace(/;jsessionid=[^\?]*|(\?)|$/,";jsessionid="+_fc[2]+"$1");case "PHPSESSID":return url.replace(/\?PHPSESSID=[^&]*&?|\?|$/,"?PHPSESSID="+_fc[2]+"&").replace(/&$/,"");}return url;};xdr.onprogress=function(){_fd(xdr);};xdr.onerror=function(){if(rq.transport!=="polling"){_40();if(_32++<rq.maxReconnectOnClose){if(rq.reconnectInterval>0){rq.reconnectId=setTimeout(function(){_80("re-connecting",_f7.transport,_f7);_d5(rq);},rq.reconnectInterval);}else{_80("re-connecting",_f7.transport,_f7);_d5(rq);}}else{_a7(0,"maxReconnectOnClose reached");}}};xdr.onload=function(){};var _fd=function(xdr){clearTimeout(rq.id);var _fe=xdr.responseText;_fe=_fe.substring(_f9);_f9+=_fe.length;if(_f8!=="polling"){_bf(rq);var _ff=_c6(_fe,rq,_2b);if(_f8==="long-polling"&&_2.trim(_fe).length===0){return;}if(rq.executeCallbackBeforeReconnect){_fa();}if(!_ff){_11d(_2b.responseBody,"messageReceived",200,_f8);}if(!rq.executeCallbackBeforeReconnect){_fa();}}};return {open:function(){var url=rq.url;if(rq.dispatchUrl!=null){url+=rq.dispatchUrl;}url=_8d(rq,url);xdr.open(rq.method,_fb(url));if(rq.method==="GET"){xdr.send();}else{xdr.send(rq.data);}if(rq.connectTimeout>0){rq.id=setTimeout(function(){if(rq.requestCount===0){_40();_11d("Connect timeout","closed",200,rq.transport);}},rq.connectTimeout);}},close:function(){xdr.abort();}};};function _d6(_100){_2f=_101(_100);_2f.open();};function _101(_102){var rq=_1b;if((_102!=null)&&(typeof (_102)!=="undefined")){rq=_102;}var stop;var doc=new window.ActiveXObject("htmlfile");doc.open();doc.close();var url=rq.url;if(rq.dispatchUrl!=null){url+=rq.dispatchUrl;}if(rq.transport!=="polling"){_2b.transport=rq.transport;}return {open:function(){var _103=doc.createElement("iframe");url=_8d(rq);if(rq.data!==""){url+="&X-Atmosphere-Post-Body="+encodeURIComponent(rq.data);}url=_2.atmosphere.prepareURL(url);_103.src=url;doc.body.appendChild(_103);var cdoc=_103.contentDocument||_103.contentWindow.document;stop=_2.atmosphere.iterate(function(){try{if(!cdoc.firstChild){return;}if(cdoc.readyState==="complete"){try{_2.noop(cdoc.fileSize);}catch(e){_11d("Connection Failure","error",500,rq.transport);return false;}}var res=cdoc.body?cdoc.body.lastChild:cdoc;var _104=function(){var _105=res.cloneNode(true);_105.appendChild(cdoc.createTextNode("."));var text=_105.innerText;text=text.substring(0,text.length-1);return text;};if(!_2.nodeName(res,"pre")){var head=cdoc.head||cdoc.getElementsByTagName("head")[0]||cdoc.documentElement||cdoc;var _106=cdoc.createElement("script");_106.text="document.write('<plaintext>')";head.insertBefore(_106,head.firstChild);head.removeChild(_106);res=cdoc.body.lastChild;}if(rq.closed){rq.isReopen=true;}stop=_2.atmosphere.iterate(function(){var text=_104();if(text.length>rq.lastIndex){_bf(_1b);_2b.status=200;_2b.error=null;res.innerText="";var _107=_c6(text,rq,_2b);if(_107){return "";}_11d(_2b.responseBody,"messageReceived",200,rq.transport);}rq.lastIndex=0;if(cdoc.readyState==="complete"){_108(true);_80("re-connecting",rq.transport,rq);if(rq.reconnectInterval>0){rq.reconnectId=setTimeout(function(){_d6(rq);},rq.reconnectInterval);}else{_d6(rq);}return false;}},null);return false;}catch(err){_2b.error=true;_80("re-connecting",rq.transport,rq);if(_32++<rq.maxReconnectOnClose){if(rq.reconnectInterval>0){rq.reconnectId=setTimeout(function(){_d6(rq);},rq.reconnectInterval);}else{_d6(rq);}}else{_a7(0,"maxReconnectOnClose reached");}doc.execCommand("Stop");doc.close();return false;}});},close:function(){if(stop){stop();}doc.execCommand("Stop");_108(true);}};};function _be(_109){if(_38!=null){_10a(_109);}else{if(_2e!=null||_2d!=null){_10b(_109);}else{if(_2f!=null){_10c(_109);}else{if(_30!=null){_10d(_109);}else{if(_2c!=null){_10e(_109);}else{_a7(0,"No suspended connection available");_2.atmosphere.error("No suspended connection available. Make sure atmosphere.subscribe has been called and request.onOpen invoked before invoking trying to push data");}}}}}};function _10a(_10f){_38.send(_10f);};function _110(_111){if(_111.length===0){return;}try{if(_38){_38.localSend(_111);}else{if(_37){_37.signal("localMessage",_2.stringifyJSON({id:_39,event:_111}));}}}catch(err){_2.atmosphere.error(err);}};function _10b(_112){var rq=_113(_112);_4c(rq);};function _10c(_114){if(_1b.enableXDR&&_2.atmosphere.checkCORSSupport()){var rq=_113(_114);rq.reconnect=false;_8a(rq);}else{_10b(_114);}};function _10d(_115){_10b(_115);};function _116(_117){var msg=_117;if(typeof (msg)==="object"){msg=_117.data;}return msg;};function _113(_118){var msg=_116(_118);var rq={connected:false,timeout:60000,method:"POST",url:_1b.url,contentType:_1b.contentType,headers:_1b.headers,reconnect:true,callback:null,data:msg,suspend:false,maxRequest:-1,logLevel:"info",requestCount:0,withCredentials:_1b.withCredentials,transport:"polling",isOpen:true,attachHeadersAsQueryString:true,enableXDR:_1b.enableXDR,uuid:_1b.uuid,dispatchUrl:_1b.dispatchUrl,enableProtocol:false,messageDelimiter:"|",trackMessageLength:_1b.trackMessageLength,maxReconnectOnClose:_1b.maxReconnectOnClose,heartbeatTimer:_1b.heartbeatTimer,heartbeat:_1b.heartbeat};if(typeof (_118)==="object"){rq=_2.extend(rq,_118);}return rq;};function _10e(_119){var msg=_2.atmosphere.isBinary(_119)?_119:_116(_119);var data;try{if(_1b.dispatchUrl!=null){data=_1b.webSocketPathDelimiter+_1b.dispatchUrl+_1b.webSocketPathDelimiter+msg;}else{data=msg;}if(!_2c.canSendMessage){_2.atmosphere.error("WebSocket not connected.");return;}_2c.send(data);}catch(e){_2c.onclose=function(_11a){};_40();_4d("Websocket failed. Downgrading to Comet and resending "+_119);_10b(_119);}};function _11b(_11c){var m=_2.parseJSON(_11c);if(m.id!==_39){if(typeof (_1b.onLocalMessage)!=="undefined"){_1b.onLocalMessage(m.event);}else{if(typeof (_2.atmosphere.onLocalMessage)!=="undefined"){_2.atmosphere.onLocalMessage(m.event);}}}};function _11d(_11e,_11f,_120,_121){_2b.responseBody=_11e;_2b.transport=_121;_2b.status=_120;_2b.state=_11f;_89();};function _e2(xdr,_122){if(!_122.readResponsesHeaders){if(!_122.enableProtocol){_122.uuid=_2.atmosphere.guid();}}else{try{var _123=xdr.getResponseHeader("X-Atmosphere-tracking-id");if(_123&&_123!=null){_122.uuid=_123.split(" ").pop();}}catch(e){}}};function _f4(_124){_125(_124,_1b);_125(_124,_2.atmosphere);};function _125(_126,f){switch(_126.state){case "messageReceived":_43("Firing onMessage");_32=0;if(typeof (f.onMessage)!=="undefined"){f.onMessage(_126);}break;case "error":_43("Firing onError");if(typeof (f.onError)!=="undefined"){f.onError(_126);}break;case "opening":_43("Firing onOpen");delete _1b.closed;if(typeof (f.onOpen)!=="undefined"){f.onOpen(_126);}break;case "messagePublished":_43("Firing onMessagePublished");if(typeof (f.onMessagePublished)!=="undefined"){f.onMessagePublished(_126);}break;case "re-connecting":_43("Firing onReconnect");if(typeof (f.onReconnect)!=="undefined"){f.onReconnect(_1b,_126);}break;case "closedByClient":_43("Firing onClientTimeout");if(typeof (f.onClientTimeout)!=="undefined"){f.onClientTimeout(_1b);}break;case "re-opening":_43("Firing onReopen");delete _1b.closed;if(typeof (f.onReopen)!=="undefined"){f.onReopen(_1b,_126);}break;case "fail-to-reconnect":_43("Firing onFailureToReconnect");if(typeof (f.onFailureToReconnect)!=="undefined"){f.onFailureToReconnect(_1b,_126);}break;case "unsubscribe":case "closed":var _127=typeof (_1b.closed)!=="undefined"?_1b.closed:false;if(!_127){_43("Firing onClose");if(typeof (f.onClose)!=="undefined"){f.onClose(_126);}}else{_43("Closed but not firing onClose");}_1b.closed=true;break;}};function _108(_128){if(_2b.state!=="closed"){_2b.state="closed";_2b.responseBody="";_2b.messages=[];_2b.status=!_128?501:200;_89();}};function _89(){var call=function(_129,func){func(_2b);};if(_38==null&&_36!=null){_36(_2b.responseBody);}_1b.reconnect=_1b.mrequest;var _12a=typeof (_2b.responseBody)==="string";var _12b=(_12a&&_1b.trackMessageLength)?(_2b.messages.length>0?_2b.messages:[""]):new Array(_2b.responseBody);for(var i=0;i<_12b.length;i++){if(_12b.length>1&&_12b[i].length===0){continue;}_2b.responseBody=(_12a)?_2.trim(_12b[i]):_12b[i];if(_38==null&&_36!=null){_36(_2b.responseBody);}if((_2b.responseBody.length===0||(_12a&&_34===_2b.responseBody))&&_2b.state==="messageReceived"){continue;}_f4(_2b);if(_2.atmosphere.callbacks.length>0){if(_41("debug")){_2.atmosphere.debug("Invoking "+_2.atmosphere.callbacks.length+" global callbacks: "+_2b.state);}try{_2.each(_2.atmosphere.callbacks,call);}catch(e){_2.atmosphere.log(_1b.logLevel,["Callback exception"+e]);}}if(typeof (_1b.callback)==="function"){if(_41("debug")){_2.atmosphere.debug("Invoking request callbacks");}try{_1b.callback(_2b);}catch(e){_2.atmosphere.log(_1b.logLevel,["Callback exception"+e]);}}}};function _e4(_12c,rq){if(_2b.partialMessage===""&&(rq.transport==="streaming")&&(_12c.responseText.length>rq.maxStreamingLength)){return true;}return false;};function _c2(){if(_1b.enableProtocol&&!_1b.firstMessage){var _12d="X-Atmosphere-Transport=close&X-Atmosphere-tracking-id="+_1b.uuid;_2.each(_1b.headers,function(name,_12e){var h=_2.isFunction(_12e)?_12e.call(this,_1b,_1b,_2b):_12e;if(h!=null){_12d+="&"+encodeURIComponent(name)+"="+encodeURIComponent(h);}});var url=_1b.url.replace(/([?&])_=[^&]*/,_12d);url=url+(url===_1b.url?(/\?/.test(_1b.url)?"&":"?")+_12d:"");if(_1b.connectTimeout>0){_2.ajax({url:url,async:_1b.closeAsync,timeout:_1b.connectTimeout,cache:false,crossDomain:_1b.enableXDR});}else{_2.ajax({url:url,async:_1b.closeAsync,cache:false,crossDomain:_1b.enableXDR});}}};function _84(){if(_1b.reconnectId){clearTimeout(_1b.reconnectId);delete _1b.reconnectId;}if(_1b.heartbeatTimer){clearTimeout(_1b.heartbeatTimer);}_1b.reconnect=false;_35=true;_2b.request=_1b;_2b.state="unsubscribe";_2b.responseBody="";_2b.status=408;_89();_c2();_40();};function _40(){_2b.partialMessage="";if(_1b.id){clearTimeout(_1b.id);}if(_1b.heartbeatTimer){clearTimeout(_1b.heartbeatTimer);}if(_1b.reconnectId){clearTimeout(_1b.reconnectId);delete _1b.reconnectId;}if(_2f!=null){_2f.close();_2f=null;}if(_30!=null){_30.abort();_30=null;}if(_2e!=null){_2e.abort();_2e=null;}if(_2c!=null){if(_2c.canSendMessage){_2c.close();}_2c=null;}if(_2d!=null){_2d.close();_2d=null;}_12f();};function _12f(){if(_37!=null){clearInterval(_3a);document.cookie=_3b+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/";_37.signal("close",{reason:"",heir:!_35?_39:(_37.get("children")||[])[0]});_37.close();}if(_38!=null){_38.close();}};this.subscribe=function(_130){_3d(_130);_4a();};this.execute=function(){_4a();};this.invokeCallback=function(){_89();};this.close=function(){_84();};this.disconnect=function(){_c2();};this.getUrl=function(){return _1b.url;};this.push=function(_131,_132){if(_132!=null){var _133=_1b.dispatchUrl;_1b.dispatchUrl=_132;_be(_131);_1b.dispatchUrl=_133;}else{_be(_131);}};this.getUUID=function(){return _1b.uuid;};this.pushLocal=function(_134){_110(_134);};this.enableProtocol=function(_135){return _1b.enableProtocol;};this.init=function(){_3e();};this.request=_1b;this.response=_2b;},subscribe:function(url,_136,_137){if(typeof (_136)==="function"){_2.atmosphere.addCallback(_136);}if(typeof (url)!=="string"){_137=url;}else{_137.url=url;}_2.atmosphere.uuid=((typeof (_137)!=="undefined")&&typeof (_137.uuid)!=="undefined")?_137.uuid:0;var rq=new _2.atmosphere.AtmosphereRequest(_137);rq.execute();_2.atmosphere.requests[_2.atmosphere.requests.length]=rq;return rq;},addCallback:function(func){if(_2.inArray(func,_2.atmosphere.callbacks)===-1){_2.atmosphere.callbacks.push(func);}},removeCallback:function(func){var _138=_2.inArray(func,_2.atmosphere.callbacks);if(_138!==-1){_2.atmosphere.callbacks.splice(_138,1);}},unsubscribe:function(){if(_2.atmosphere.requests.length>0){var _139=[].concat(_2.atmosphere.requests);for(var i=0;i<_139.length;i++){var rq=_139[i];rq.close();clearTimeout(rq.response.request.id);if(rq.heartbeatTimer){clearTimeout(rq.heartbeatTimer);}}}_2.atmosphere.requests=[];_2.atmosphere.callbacks=[];},unsubscribeUrl:function(url){var idx=-1;if(_2.atmosphere.requests.length>0){for(var i=0;i<_2.atmosphere.requests.length;i++){var rq=_2.atmosphere.requests[i];if(rq.getUrl()===url){rq.close();clearTimeout(rq.response.request.id);if(rq.heartbeatTimer){clearTimeout(rq.heartbeatTimer);}idx=i;break;}}}if(idx>=0){_2.atmosphere.requests.splice(idx,1);}},publish:function(_13a){if(typeof (_13a.callback)==="function"){_2.atmosphere.addCallback(_13a.callback);}_13a.transport="polling";var rq=new _2.atmosphere.AtmosphereRequest(_13a);_2.atmosphere.requests[_2.atmosphere.requests.length]=rq;return rq;},checkCORSSupport:function(){if(_2.browser.msie&&!window.XDomainRequest&&+_2.browser.version.split(".")[0]<11){return true;}else{if(_2.browser.opera&&+_2.browser.version.split(".")[0]<12){return true;}else{if(_2.trim(navigator.userAgent).slice(0,16)==="KreaTVWebKit/531"){return true;}else{if(_2.trim(navigator.userAgent).slice(-7).toLowerCase()==="kreatel"){return true;}}}}var ua=navigator.userAgent.toLowerCase();var _13b=ua.indexOf("android")>-1;if(_13b){return true;}return false;},S4:function(){return (((1+Math.random())*65536)|0).toString(16).substring(1);},guid:function(){return (_2.atmosphere.S4()+_2.atmosphere.S4()+"-"+_2.atmosphere.S4()+"-"+_2.atmosphere.S4()+"-"+_2.atmosphere.S4()+"-"+_2.atmosphere.S4()+_2.atmosphere.S4()+_2.atmosphere.S4());},prepareURL:function(url){var ts=_2.now();var ret=url.replace(/([?&])_=[^&]*/,"$1_="+ts);return ret+(ret===url?(/\?/.test(url)?"&":"?")+"_="+ts:"");},param:function(data){return _2.param(data,_2.ajaxSettings.traditional);},supportStorage:function(){var _13c=window.localStorage;if(_13c){try{_13c.setItem("t","t");_13c.removeItem("t");return window.StorageEvent&&!_2.browser.msie&&!(_2.browser.mozilla&&_2.browser.version.split(".")[0]==="1");}catch(e){}}return false;},iterate:function(fn,_13d){var _13e;_13d=_13d||0;(function loop(){_13e=setTimeout(function(){if(fn()===false){return;}loop();},_13d);})();return function(){clearTimeout(_13e);};},log:function(_13f,args){if(window.console){var _140=window.console[_13f];if(typeof _140==="function"){_140.apply(window.console,args);}}},warn:function(){_2.atmosphere.log("warn",arguments);},info:function(){_2.atmosphere.log("info",arguments);},debug:function(){_2.atmosphere.log("debug",arguments);},error:function(){_2.atmosphere.log("error",arguments);},isBinary:function(data){return /^\[object\s(?:Blob|ArrayBuffer|.+Array)\]$/.test(Object.prototype.toString.call(data));}};(function(){var _141,_142;_2.uaMatch=function(ua){ua=ua.toLowerCase();var _143=/(chrome)[ \/]([\w.]+)/.exec(ua)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(ua)||/(msie) ([\w.]+)/.exec(ua)||/(trident)(?:.*? rv:([\w.]+)|)/.exec(ua)||ua.indexOf("android")<0&&/version\/(.+) (safari)/.exec(ua)||ua.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(ua)||[];if(_143[2]==="safari"){_143[2]=_143[1];_143[1]="safari";}return {browser:_143[1]||"",version:_143[2]||"0"};};_141=_2.uaMatch(navigator.userAgent);_142={};if(_141.browser){_142[_141.browser]=true;_142.version=_141.version;_142.vmajor=_142.version.split(".")[0];}if(_142.trident){_142.msie=true;}_2.browser=_142;_2.sub=function(){function _144(_145,_146){return new _144.fn.init(_145,_146);};_2.extend(true,_144,this);_144.superclass=this;_144.fn=_144.prototype=this();_144.fn.constructor=_144;_144.sub=this.sub;_144.fn.init=function init(_147,_148){if(_148&&_148 instanceof _2&&!(_148 instanceof _144)){_148=_144(_148);}return _2.fn.init.call(this,_147,_148,_149);};_144.fn.init.prototype=_144.fn;var _149=_144(document);return _144;};})();(function(_14a){var _14b=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r","\"":"\\\"","\\":"\\\\"};function _14c(_14d){return "\""+_14d.replace(_14b,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4);})+"\"";};function f(n){return n<10?"0"+n:n;};function str(key,_14e){var i,v,len,_14f,_150=_14e[key],type=typeof _150;if(_150&&typeof _150==="object"&&typeof _150.toJSON==="function"){_150=_150.toJSON(key);type=typeof _150;}switch(type){case "string":return _14c(_150);case "number":return isFinite(_150)?String(_150):"null";case "boolean":return String(_150);case "object":if(!_150){return "null";}switch(Object.prototype.toString.call(_150)){case "[object Date]":return isFinite(_150.valueOf())?"\""+_150.getUTCFullYear()+"-"+f(_150.getUTCMonth()+1)+"-"+f(_150.getUTCDate())+"T"+f(_150.getUTCHours())+":"+f(_150.getUTCMinutes())+":"+f(_150.getUTCSeconds())+"Z"+"\"":"null";case "[object Array]":len=_150.length;_14f=[];for(i=0;i<len;i++){_14f.push(str(i,_150)||"null");}return "["+_14f.join(",")+"]";default:_14f=[];for(i in _150){if(Object.prototype.hasOwnProperty.call(_150,i)){v=str(i,_150);if(v){_14f.push(_14c(i)+":"+v);}}}return "{"+_14f.join(",")+"}";}}};_14a.stringifyJSON=function(_151){if(window.JSON&&window.JSON.stringify){return window.JSON.stringify(_151);}return str("",{"":_151});};}(_2));}));